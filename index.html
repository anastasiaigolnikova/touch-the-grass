<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>üåø —Ç—Ä–∞–≤–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            height: 100vh;
            overflow: hidden;
            background: linear-gradient(to bottom, #b8c8a6, #8a9b7a);
            position: relative;
        }

        #grassCanvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
            cursor: pointer;
            will-change: transform;
        }

        .pearl {
            position: fixed;
            width: 32px;
            height: 32px;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.95), rgba(240, 245, 240, 0.85));
            border-radius: 50%;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.15),
                inset -2px -2px 8px rgba(0, 0, 0, 0.1),
                inset 2px 2px 8px rgba(255, 255, 255, 0.8),
                0 0 20px rgba(255, 255, 255, 0.6),
                0 0 40px rgba(255, 255, 255, 0.3);
            cursor: pointer;
            z-index: 10;
            transition: transform 0.2s ease;
            pointer-events: all;
            animation: pearlRise 1.5s ease-out forwards, pearlGlow 2s ease-in-out infinite;
            opacity: 0;
        }

        .pearl:hover {
            transform: scale(1.2) !important;
        }

        .pearl:active {
            transform: scale(0.9) !important;
        }

        @keyframes pearlRise {
            0% {
                transform: translateY(100px) scale(0.3);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        @keyframes pearlGlow {
            0%, 100% {
                box-shadow: 
                    0 4px 12px rgba(0, 0, 0, 0.15),
                    inset -2px -2px 8px rgba(0, 0, 0, 0.1),
                    inset 2px 2px 8px rgba(255, 255, 255, 0.8),
                    0 0 20px rgba(255, 255, 255, 0.6),
                    0 0 40px rgba(255, 255, 255, 0.3);
            }
            50% {
                box-shadow: 
                    0 4px 12px rgba(0, 0, 0, 0.15),
                    inset -2px -2px 8px rgba(0, 0, 0, 0.1),
                    inset 2px 2px 8px rgba(255, 255, 255, 0.8),
                    0 0 30px rgba(255, 255, 200, 0.8),
                    0 0 60px rgba(255, 255, 200, 0.5);
            }
        }

        .pearl::before {
            content: '';
            position: absolute;
            top: 25%;
            left: 25%;
            width: 10px;
            height: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            filter: blur(2px);
        }

        #pearlModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #pearlModal.show {
            display: flex;
            opacity: 1;
        }

        #pearlContent {
            background: rgba(255, 255, 255, 0.88);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 50px 40px;
            border-radius: 32px;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            max-width: 380px;
            width: 90%;
            text-align: center;
            font-size: 20px;
            line-height: 1.6;
            color: #2a3a2a;
            position: relative;
            animation: modalSlideIn 0.4s ease-out;
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(30px) scale(0.95);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        @keyframes modalEvaporate {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
                filter: blur(0px);
            }
            50% {
                transform: translateY(-20px) scale(1.05);
                opacity: 0.7;
                filter: blur(2px);
            }
            100% {
                transform: translateY(-60px) scale(1.15);
                opacity: 0;
                filter: blur(10px);
            }
        }

        #pearlContent.evaporating {
            animation: modalEvaporate 0.8s ease-out forwards;
        }

        #pearlText {
            font-weight: 500;
            white-space: pre-line;
            margin: 0;
        }

        #closeModal {
            display: none;
        }

        /* –ñ–∏—Ç–µ–ª–∏ —Ç—Ä–∞–≤—ã */
        .creature {
            position: fixed;
            font-size: 24px;
            z-index: 5;
            pointer-events: none;
            user-select: none;
        }

        .butterfly {
            animation: butterflyFly 3s ease-out forwards, butterflyFlutter 0.3s ease-in-out infinite;
        }

        @keyframes butterflyFly {
            0% {
                transform: translate(0, 0) scale(0.5);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            100% {
                transform: translate(var(--dx), var(--dy)) scale(1);
                opacity: 0;
            }
        }

        @keyframes butterflyFlutter {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .firefly {
            animation: fireflyRise var(--duration) ease-in-out forwards, fireflyGlow 1s ease-in-out infinite;
            text-shadow: 0 0 8px rgba(255, 255, 150, 0.8);
        }

        @keyframes fireflyRise {
            0% {
                transform: translate(0, 0) scale(0.3);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            30% {
                transform: translate(calc(var(--dx) * 0.3), calc(var(--dy) * 0.4)) scale(0.8);
            }
            60% {
                transform: translate(calc(var(--dx) * 0.7), calc(var(--dy) * 0.6)) scale(1.1);
            }
            100% {
                transform: translate(var(--dx), var(--dy)) scale(0.7);
                opacity: 0;
            }
        }

        @keyframes fireflyGlow {
            0%, 100% { 
                filter: brightness(1);
                text-shadow: 0 0 8px rgba(255, 255, 150, 0.8);
            }
            50% { 
                filter: brightness(1.6);
                text-shadow: 0 0 16px rgba(255, 255, 150, 1);
            }
        }

        .grasshopper {
            animation: grasshopperJump 1.2s ease-out forwards;
        }

        @keyframes grasshopperJump {
            0% {
                transform: translate(0, 0) scale(0.5) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            40% {
                transform: translate(calc(var(--dx) * 0.5), -60px) scale(1) rotate(15deg);
            }
            100% {
                transform: translate(var(--dx), 20px) scale(0.8) rotate(25deg);
                opacity: 0;
            }
        }

        /* –ö—Ä–æ–ª–∏–∫ - –±–æ–ª—å—à–∏–µ —á–∞—Å—Ç–∏ —Ç–µ–ª–∞ */
        .rabbit {
            font-size: 120px; /* –Ω–∞–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ */
            animation: rabbitPeek 2.5s ease-in-out forwards;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.2));
        }

        .rabbit-ears {
            font-size: 100px;
        }

        .rabbit-nose {
            font-size: 80px;
        }

        .rabbit-tail {
            font-size: 90px;
        }

        @keyframes rabbitPeek {
            0% {
                transform: translateY(120px);
                opacity: 0;
            }
            15% {
                opacity: 1;
            }
            35%, 65% {
                transform: translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateY(120px);
                opacity: 0;
            }
        }

        @media (max-width: 600px) {
            #pearlContent {
                max-width: 300px;
                padding: 35px 30px;
                font-size: 17px;
            }
            .pearl {
                width: 28px;
                height: 28px;
            }
            .creature {
                font-size: 20px;
            }
            .rabbit {
                font-size: 80px;
            }
            .rabbit-ears {
                font-size: 70px;
            }
            .rabbit-nose {
                font-size: 60px;
            }
            .rabbit-tail {
                font-size: 70px;
            }
        }
    </style>
</head>
<body>
    <canvas id="grassCanvas"></canvas>

    <div id="pearlModal">
        <div id="pearlContent">
            <div id="pearlText"></div>
            <button id="closeModal">üåø</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('grassCanvas');
        const ctx = canvas.getContext('2d');
        const modal = document.getElementById('pearlModal');
        const pearlText = document.getElementById('pearlText');
        const closeBtn = document.getElementById('closeModal');

        let width = canvas.width = window.innerWidth;
        let height = canvas.height = window.innerHeight;
        let grass = [];
        let touchPos = null;
        let windTime = 0;

        const wisdoms = [
            "–æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–π –≤—ã–¥–æ—Ö –¥–æ–ª—å—à–µ –≤–¥–æ—Ö–∞",
            "–ø–µ–π –≤–æ–¥—É: 6 –≥–ª–æ—Ç–∫–æ–≤",
            "–ø–æ–º–µ–Ω—è–π –ø–æ–∑—É: —Å–º—è–≥—á–∏ —á–µ–ª—é—Å—Ç—å",
            "–∑–∞–∫—Ä–æ–π –≥–ª–∞–∑–∞ –∏ —Å–ª—É—à–∞–π 10 —Å–µ–∫",
            "—É–¥–∞–ª–∏ 3 –ª–∏—à–Ω–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
        ];

        let collected = JSON.parse(localStorage.getItem('grassPearls') || '[]');
        let activePearls = [];
        let touchMoveDistance = 0;
        let lastTouchPos = null;
        let touchStartTime = 0;
        let touchCounter = 0; // –°—á—ë—Ç—á–∏–∫ –¥–≤–∏–∂–µ–Ω–∏–π –¥–ª—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∂–∏—Ç–µ–ª–µ–π

        // === –î–í–£–•–°–õ–û–ô–ù–ê–Ø –ó–í–£–ö–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê ===
        // –°–ª–æ–π 1: Web Audio API ‚Äî —Å–∏–Ω—Ç–µ–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–≤—É–∫–∏ (–∫–æ—Å–º–∏—á–µ—Å–∫–∏–µ)
        let audioContext;
        let windSound;
        let isTouching = false;

        // –°–ª–æ–π 2: HTML5 Audio ‚Äî —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏—Ä–æ–¥—ã (—Ñ–æ–Ω–æ–≤—ã–π ambient)
        let ambientAudio = null;
        let audioInitialized = false;

        const AMBIENT_SOUNDS = [
            "https://assets.mixkit.co/active_storage/sfx/2458/2458.wav", // birds + wind
            "https://assets.mixkit.co/active_storage/sfx/513/513.wav"     // nature ambience
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Audio Context (—Å–∏–Ω—Ç–µ–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–≤—É–∫–∏)
        function initAudio() {
            if (audioInitialized) return;
            audioInitialized = true;

            // Web Audio API –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–≤—É–∫–æ–≤
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                createWindSound();
                createBirdSounds();
                startIdleCreatures(); // –ó–∞–ø—É—Å–∫–∞–µ–º –∫—É–∑–Ω–µ—á–∏–∫–æ–≤ –≤ –ø–æ–∫–æ–µ
            }

            // HTML5 Audio –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã (–æ—á–µ–Ω—å —Ç–∏—Ö–æ)
            ambientAudio = new Audio(AMBIENT_SOUNDS[0]);
            ambientAudio.loop = true;
            ambientAudio.volume = 0.08; // –æ—á–µ–Ω—å —Ç–∏—Ö–æ, –∫–∞–∫ –¥–∞–ª–µ–∫–∏–π —Ñ–æ–Ω
            ambientAudio.play().catch(() => {});
        }

        // –°–æ–∑–¥–∞—ë–º —Ñ–æ–Ω–æ–≤—ã–π —Å–∏–Ω—Ç–µ–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–≤—É–∫ –≤–µ—Ç—Ä–∞
        function createWindSound() {
            const bufferSize = audioContext.sampleRate * 2;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const data = buffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                data[i] = (Math.random() * 2 - 1) * 0.03;
            }
            
            windSound = audioContext.createBufferSource();
            windSound.buffer = buffer;
            windSound.loop = true;
            
            const windGain = audioContext.createGain();
            windGain.gain.value = 0.10; // —Ç–∏—à–µ –¥–ª—è –º—è–≥–∫–æ–≥–æ —Ñ–æ–Ω–∞
            
            const windFilter = audioContext.createBiquadFilter();
            windFilter.type = 'lowpass';
            windFilter.frequency.value = 800;
            
            windSound.connect(windFilter);
            windFilter.connect(windGain);
            windGain.connect(audioContext.destination);
            
            windSound.start(0);
        }

        // –°–æ–∑–¥–∞—ë–º —Å–∏–Ω—Ç–µ–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–≤—É–∫–∏ –ø—Ç–∏—Ü (—Ä–µ–¥–∫–æ, —Ç–∏—Ö–æ)
        function createBirdSounds() {
            setInterval(() => {
                if (Math.random() > 0.85 && audioContext) {
                    playBirdChirp();
                }
            }, 12000); // —Ä–∞–∑ –≤ 12 —Å–µ–∫—É–Ω–¥
        }

        // –£–±—Ä–∞–ª–∏ –º–æ–Ω–æ—Ç–æ–Ω–Ω—ã–µ —Å–≤–µ—Ä—á–∫–∏ - –≤–º–µ—Å—Ç–æ –Ω–∏—Ö –±—É–¥—É—Ç —Å–ª—É—á–∞–π–Ω—ã–µ –∫—É–∑–Ω–µ—á–∏–∫–∏

        function playBirdChirp() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.type = 'sine';
            oscillator.frequency.value = 2000 + Math.random() * 1000;
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.06, audioContext.currentTime + 0.01); // —Ç–∏—à–µ
            gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.15);
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.15);
        }


        // –ú–∞–≥–∏—á–µ—Å–∫–∏–π –∫–æ—Å–º–∏—á–µ—Å–∫–∏–π –∑–≤—É–∫ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –∂–µ–º—á—É–∂–∏–Ω—ã
        function playPearlAppearSound() {
            if (!audioContext) return;
            
            const oscillator1 = audioContext.createOscillator();
            const oscillator2 = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator1.type = 'sine';
            oscillator1.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator1.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.3);
            
            oscillator2.type = 'sine';
            oscillator2.frequency.setValueAtTime(1200, audioContext.currentTime);
            oscillator2.frequency.exponentialRampToValueAtTime(1600, audioContext.currentTime + 0.3);
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.05);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator1.connect(gainNode);
            oscillator2.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator1.start(audioContext.currentTime);
            oscillator2.start(audioContext.currentTime);
            oscillator1.stop(audioContext.currentTime + 0.3);
            oscillator2.stop(audioContext.currentTime + 0.3);
        }

        // –î–∏–¥–∂–∏—Ç–∞–ª—å–Ω—ã–π –∑–≤—É–∫ —Ç—Ä–∞–≤—ã –ø—Ä–∏ –∫–∞—Å–∞–Ω–∏–∏
        function playGrassRustleSound() {
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();
            
            oscillator.type = 'brown';
            filter.type = 'bandpass';
            filter.frequency.value = 400 + Math.random() * 300;
            filter.Q.value = 2;
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.08, audioContext.currentTime + 0.02);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            
            oscillator.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.2);
        }

        // –ó–≤—É–∫ –±–∞–±–æ—á–∫–∏
        function playButterflySound() {
            if (!audioContext) return;
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(800, audioContext.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1400, audioContext.currentTime + 0.15);
            gain.gain.setValueAtTime(0, audioContext.currentTime);
            gain.gain.linearRampToValueAtTime(0.05, audioContext.currentTime + 0.02);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + 0.15);
        }

        // –ó–≤—É–∫ —Å–≤–µ—Ç–ª—è—á–∫–∞
        function playFireflySound() {
            if (!audioContext) return;
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.type = 'sine';
            osc.frequency.value = 1800;
            gain.gain.setValueAtTime(0, audioContext.currentTime);
            gain.gain.linearRampToValueAtTime(0.03, audioContext.currentTime + 0.05);
            gain.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.3);
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + 0.3);
        }

        // –ó–≤—É–∫ –∫—É–∑–Ω–µ—á–∏–∫–∞
        function playGrasshopperSound() {
            if (!audioContext) return;
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.type = 'square';
            osc.frequency.value = 3000 + Math.random() * 1000;
            gain.gain.setValueAtTime(0, audioContext.currentTime);
            gain.gain.linearRampToValueAtTime(0.06, audioContext.currentTime + 0.01);
            gain.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.08);
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + 0.08);
        }

        // –ö–ª–∞—Å—Å —Ç—Ä–∞–≤–∏–Ω–∫–∏
        class GrassBlade {
            constructor(x, y, layer) {
                this.x = x;
                this.baseY = y;
                this.y = y;
                this.height = 180 + Math.random() * 300;
                this.width = 6 + Math.random() * 9;
                this.segments = 6; // –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø: –±—ã–ª–æ 8, —Å—Ç–∞–ª–æ 6 —Å–µ–≥–º–µ–Ω—Ç–æ–≤
                this.bendAmount = 0;
                this.targetBend = 0;
                this.windPhase = Math.random() * Math.PI * 2;
                this.windSpeed = 0.5 + Math.random() * 0.5;
                this.layer = layer;
                
                const hue = 80 + Math.random() * 40;
                const sat = 40 + Math.random() * 30;
                const light = 35 + Math.random() * 25;
                this.color = `hsl(${hue}, ${sat}%, ${light}%)`;
                this.tipColor = `hsl(${hue + 10}, ${sat + 10}%, ${light + 15}%)`;
            }

            update() {
                const windForce = Math.sin(windTime * this.windSpeed + this.windPhase) * 3;
                
                let touchForce = 0;
                if (touchPos) {
                    // –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø: —É–ø—Ä–æ—â–∞–µ–º —Ä–∞—Å—á—ë—Ç - —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Ç–æ—á–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
                    const dx = this.x - touchPos.x;
                    const dy = this.baseY - this.height * 0.5 - touchPos.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    const touchRadius = 200;
                    if (dist < touchRadius) {
                        const force = (1 - dist / touchRadius);
                        touchForce = Math.sign(dx) * force * 150;
                    }
                }
                
                this.targetBend = windForce + touchForce;
                this.bendAmount += (this.targetBend - this.bendAmount) * 0.25;
            }

            draw() {
                const segmentHeight = this.height / this.segments;
                
                ctx.save();
                ctx.globalAlpha = 0.6 + this.layer * 0.15;
                
                const gradient = ctx.createLinearGradient(
                    this.x, this.baseY,
                    this.x + this.bendAmount, this.baseY - this.height
                );
                gradient.addColorStop(0, this.color);
                gradient.addColorStop(0.7, this.color);
                gradient.addColorStop(1, this.tipColor);
                
                ctx.strokeStyle = gradient;
                ctx.lineWidth = this.width;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';

                ctx.beginPath();
                ctx.moveTo(this.x, this.baseY);

                for (let i = 1; i <= this.segments; i++) {
                    const progress = i / this.segments;
                    const bend = this.bendAmount * progress * progress;
                    const wobble = Math.sin(progress * Math.PI) * 2;
                    
                    const x = this.x + bend + wobble;
                    const y = this.baseY - segmentHeight * i;
                    
                    ctx.lineTo(x, y);
                }

                ctx.stroke();
                ctx.restore();
            }
        }

        function initGrass() {
            grass = [];
            // –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø: —É–º–µ–Ω—å—à–∞–µ–º –ø–ª–æ—Ç–Ω–æ—Å—Ç—å —Ç—Ä–∞–≤—ã –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            const density = width * height / 100; // –±—ã–ª–æ /50, —Å—Ç–∞–ª–æ /100 - –≤ 2 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ
            
            for (let layer = 0; layer < 3; layer++) {
                const layerDensity = density / (layer + 1);
                
                for (let i = 0; i < layerDensity; i++) {
                    const x = Math.random() * (width + 200) - 100;
                    const y = Math.random() * (height + 200) - 100;
                    grass.push(new GrassBlade(x, y, layer));
                }
            }
            
            grass.sort((a, b) => {
                if (a.layer !== b.layer) return a.layer - b.layer;
                return a.baseY - b.baseY;
            });
        }

        function animate() {
            const gradient = ctx.createLinearGradient(0, 0, 0, height);
            gradient.addColorStop(0, '#c8d8b6');
            gradient.addColorStop(0.6, '#a8b896');
            gradient.addColorStop(1, '#7a8a6a');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);
            
            windTime += 0.018;
            
            grass.forEach(blade => {
                blade.update();
                blade.draw();
            });
            
            requestAnimationFrame(animate);
        }

        function handleTouch(e) {
            const rect = canvas.getBoundingClientRect();
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
            
            if (!audioContext) {
                initAudio();
            }
            
            if (lastTouchPos) {
                const dx = x - lastTouchPos.x;
                const dy = y - lastTouchPos.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                touchMoveDistance += dist;
                
                // –î–∏–¥–∂–∏—Ç–∞–ª—å–Ω—ã–π –∑–≤—É–∫ —Ç—Ä–∞–≤—ã –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏
                if (dist > 3 && Math.random() > 0.6) {
                    playGrassRustleSound();
                    touchCounter++;
                    
                    // –ñ–∏—Ç–µ–ª–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –∫–∞—Å–∞–Ω–∏–∏
                    if (Math.random() > 0.90) {
                        spawnCreature(x, y);
                    }
                    
                    // –ö—Ä–æ–ª–∏–∫ –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–Ω—É—Ç—å –∫–æ–≥–¥–∞ —Ä–∞–∑–¥–≤–∏–≥–∞–µ—à—å —Ç—Ä–∞–≤—É
                    maybeSpawnRabbitOnTouch(x, y);
                    
                    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∂–∏—Ç–µ–ª–∏ –∫–∞–∂–¥—ã–µ 10 –¥–≤–∏–∂–µ–Ω–∏–π
                    if (touchCounter >= 10 && activePearls.length === 0) {
                        spawnCreature(x, y);
                        touchCounter = 0;
                    }
                }
                
                // –ñ–µ–º—á—É–∂–∏–Ω–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –∂–∏—Ç–µ–ª–µ–π
                if (touchMoveDistance > 150 && activePearls.length === 0 && touchCounter < 10) {
                    createPearlAtTouch(x, y);
                    touchMoveDistance = 0;
                }
            }
            
            lastTouchPos = { x, y };
            touchPos = { x, y };
            isTouching = true;
        }

        function handleTouchStart(e) {
            const rect = canvas.getBoundingClientRect();
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
            
            if (!audioContext) {
                initAudio();
            }
            
            lastTouchPos = { x, y };
            touchPos = { x, y };
            touchMoveDistance = 0;
            touchStartTime = Date.now();
            isTouching = true;
        }

        function handleTouchEnd() {
            touchPos = null;
            lastTouchPos = null;
            touchMoveDistance = 0;
            isTouching = false;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∂–∏—Ç–µ–ª—è —Ç—Ä–∞–≤—ã
        function spawnCreature(x, y, forceType = null) {
            const types = [
                { emoji: 'ü¶ã', class: 'butterfly', sound: playButterflySound },
                { emoji: '‚ú®', class: 'firefly', sound: playFireflySound },
                { emoji: 'ü¶ó', class: 'grasshopper', sound: playGrasshopperSound }
            ];
            const type = forceType ? types.find(t => t.class === forceType) : types[Math.floor(Math.random() * types.length)];
            
            const creature = document.createElement('div');
            creature.className = `creature ${type.class}`;
            creature.textContent = type.emoji;
            creature.style.left = x + 'px';
            creature.style.top = y + 'px';
            
            // –†–∞–Ω–¥–æ–º–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è —Å –±–æ–ª—å—à–µ–π –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å—é
            if (type.class === 'firefly') {
                // –°–≤–µ—Ç–ª—è—á–∫–∏ –ª–µ—Ç—è—Ç –≤ —Ä–∞–∑–Ω—ã—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö –±–æ–ª–µ–µ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ
                const dx = (Math.random() - 0.5) * 400; // –±–æ–ª—å—à–µ —Ä–∞–∑–±—Ä–æ—Å –ø–æ X
                const dy = -(Math.random() * 250 + 80); // —Ä–∞–∑–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –ø–æ–¥—ä—ë–º–∞
                const duration = 3 + Math.random() * 3; // –æ—Ç 3 –¥–æ 6 —Å–µ–∫—É–Ω–¥
                creature.style.setProperty('--dx', dx + 'px');
                creature.style.setProperty('--dy', dy + 'px');
                creature.style.setProperty('--duration', duration + 's');
            } else if (type.class === 'grasshopper') {
                // –ö—É–∑–Ω–µ—á–∏–∫–∏ –ø—Ä—ã–≥–∞—é—Ç –≤ —Ä–∞–∑–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
                const dx = (Math.random() - 0.5) * 300;
                const dy = Math.random() * 80 + 100;
                creature.style.setProperty('--dx', dx + 'px');
                creature.style.setProperty('--dy', dy + 'px');
            } else {
                // –ë–∞–±–æ—á–∫–∏
                const dx = (Math.random() - 0.5) * 250;
                const dy = -(Math.random() * 180 + 80);
                creature.style.setProperty('--dx', dx + 'px');
                creature.style.setProperty('--dy', dy + 'px');
            }
            
            document.body.appendChild(creature);
            type.sound();
            
            // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
            const duration = type.class === 'grasshopper' ? 1200 : (type.class === 'firefly' ? 6000 : 3000);
            setTimeout(() => creature.remove(), duration);
        }

        // –ü–æ—è–≤–ª–µ–Ω–∏–µ –∫—Ä–æ–ª–∏–∫–∞ (—á–∞—Å—Ç–∏ —Ç–µ–ª–∞ –∫–∞–∫ –±—É–¥—Ç–æ —Å–∏–¥–∏—Ç –≤ —Ç—Ä–∞–≤–µ)
        function spawnRabbit() {
            // –†–∞–∑–Ω—ã–µ —á–∞—Å—Ç–∏ –∫—Ä–æ–ª–∏–∫–∞ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –∫–ª–∞—Å—Å–∞–º–∏
            const parts = [
                { emoji: 'üëÇ', class: 'rabbit rabbit-ears', name: 'ears' },      // —É—à–∏
                { emoji: 'üëÉ', class: 'rabbit rabbit-nose', name: 'nose' },      // –Ω–æ—Å
                { emoji: 'üê∞', class: 'rabbit', name: 'face' },                  // –º–æ—Ä–¥–æ—á–∫–∞
                { emoji: '‚óã', class: 'rabbit rabbit-tail', name: 'tail' }       // —Ö–≤–æ—Å—Ç–∏–∫ (–±–µ–ª—ã–π –∫—Ä—É–∂–æ–∫)
            ];
            
            const part = parts[Math.floor(Math.random() * parts.length)];
            
            const rabbit = document.createElement('div');
            rabbit.className = `creature ${part.class}`;
            
            // –î–ª—è —Ö–≤–æ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–µ–ª—ã–π –ø—É—à–∏—Å—Ç—ã–π –∫—Ä—É–≥
            if (part.name === 'tail') {
                rabbit.innerHTML = '<div style="width: 80px; height: 80px; background: radial-gradient(circle, #fff 0%, #f5f5f5 60%, rgba(245,245,245,0.8) 100%); border-radius: 50%; box-shadow: 0 2px 12px rgba(0,0,0,0.15), inset -2px -2px 6px rgba(0,0,0,0.1);"></div>';
            } else {
                rabbit.textContent = part.emoji;
            }
            
            // –ü–æ—è–≤–ª—è–µ—Ç—Å—è —Å–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞ —Å–ª—É—á–∞–π–Ω–æ
            const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
            const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
            
            // –†–∞–∑–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç–µ–π
            const x = Math.random() * (vw - 200) + 100;
            const y = vh - 100 - Math.random() * 50; // –æ–∫–æ–ª–æ –Ω–∏–∂–Ω–µ–≥–æ –∫—Ä–∞—è
            
            rabbit.style.left = x + 'px';
            rabbit.style.top = y + 'px';
            
            document.body.appendChild(rabbit);
            
            // –ó–≤—É–∫ –∫—Ä–æ–ª–∏–∫–∞
            if (audioContext && Math.random() > 0.4) {
                playGrassRustleSound(); // —à–æ—Ä–æ—Ö —Ç—Ä–∞–≤—ã –æ—Ç –∫—Ä–æ–ª–∏–∫–∞
            }
            
            setTimeout(() => rabbit.remove(), 2500);
        }

        // –ö—É–∑–Ω–µ—á–∏–∫–∏ –ø—Ä—ã–≥–∞—é—Ç –∏–∑—Ä–µ–¥–∫–∞ –≤ –ø–æ–∫–æ–µ
        function startIdleCreatures() {
            // –ö—É–∑–Ω–µ—á–∏–∫–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è
            setInterval(() => {
                if (!isTouching && Math.random() > 0.6) {
                    const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
                    const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
                    const x = Math.random() * vw;
                    const y = vh * 0.6 + Math.random() * vh * 0.4; // –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞
                    spawnCreature(x, y, 'grasshopper');
                }
            }, 7000); // –∫–∞–∂–¥—ã–µ 7 —Å–µ–∫—É–Ω–¥

            // –ö—Ä–æ–ª–∏–∫ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–∫–æ–µ - –±–æ–ª—å—à–æ–π –≤ —Ç—Ä–∞–≤–µ
            setInterval(() => {
                if (!isTouching && Math.random() > 0.7) {
                    spawnRabbit();
                }
            }, 10000); // –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
        }
        
        // –ö—Ä–æ–ª–∏–∫ –º–æ–∂–µ—Ç –ø–æ—è–≤–∏—Ç—å—Å—è –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –∫–∞—Å–∞–Ω–∏–∏ —Ç—Ä–∞–≤—ã
        function maybeSpawnRabbitOnTouch(x, y) {
            // 5% —à–∞–Ω—Å —á—Ç–æ —Ä–∞–∑–¥–≤–∏–Ω–µ—à—å —Ç—Ä–∞–≤—É –∏ —É–≤–∏–¥–∏—à—å —á–∞—Å—Ç—å –∫—Ä–æ–ª–∏–∫–∞
            if (Math.random() > 0.95 && activePearls.length === 0) {
                spawnRabbit();
            }
        }

        function createPearlAtTouch(x, y) {
            const pearl = document.createElement('div');
            pearl.className = 'pearl';
            
            const offsetX = (Math.random() - 0.5) * 100;
            const offsetY = (Math.random() - 0.5) * 50;
            
            pearl.style.left = (x + offsetX) + 'px';
            pearl.style.top = (y + offsetY) + 'px';
            
            // –ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –∑–≤—É–∫ –ø–æ—è–≤–ª–µ–Ω–∏—è –∂–µ–º—á—É–∂–∏–Ω—ã
            playPearlAppearSound();
            
            const availableWisdoms = wisdoms.filter((_, i) => !collected.includes(i));
            const wisdomIndex = availableWisdoms.length > 0 
                ? wisdoms.indexOf(availableWisdoms[Math.floor(Math.random() * availableWisdoms.length)])
                : Math.floor(Math.random() * wisdoms.length);
            
            pearl.addEventListener('click', (e) => {
                e.stopPropagation();
                showWisdom(wisdomIndex);
                pearl.remove();
                activePearls = activePearls.filter(p => p !== pearl);
            });
            
            document.body.appendChild(pearl);
            activePearls.push(pearl);
            
            setTimeout(() => {
                if (activePearls.includes(pearl)) {
                    pearl.style.transition = 'opacity 0.5s ease';
                    pearl.style.opacity = '0';
                    setTimeout(() => {
                        pearl.remove();
                        activePearls = activePearls.filter(p => p !== pearl);
                    }, 500);
                }
            }, 10000);
        }

        canvas.addEventListener('touchstart', handleTouchStart);
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            handleTouch(e);
        }, { passive: false });
        canvas.addEventListener('touchend', handleTouchEnd);
        
        canvas.addEventListener('mousedown', handleTouchStart);
        canvas.addEventListener('mousemove', (e) => {
            if (e.buttons === 1) handleTouch(e);
        });
        canvas.addEventListener('mouseup', handleTouchEnd);
        canvas.addEventListener('mouseleave', handleTouchEnd);

        window.addEventListener('resize', () => {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            initGrass();
        });

        function showWisdom(index) {
            const content = document.getElementById('pearlContent');
            content.classList.remove('evaporating');
            
            pearlText.textContent = wisdoms[index];
            modal.classList.add('show');
            
            if (!collected.includes(index)) {
                collected.push(index);
                localStorage.setItem('grassPearls', JSON.stringify(collected));
            }
            
            setTimeout(() => {
                content.classList.add('evaporating');
                setTimeout(() => {
                    modal.classList.remove('show');
                    content.classList.remove('evaporating');
                }, 800);
            }, 2500);
        }

        closeBtn.addEventListener('click', () => {
            modal.classList.remove('show');
        });

        modal.addEventListener('click', () => {
            const content = document.getElementById('pearlContent');
            content.classList.add('evaporating');
            setTimeout(() => {
                modal.classList.remove('show');
                content.classList.remove('evaporating');
            }, 800);
        });

        document.getElementById('pearlContent').addEventListener('click', (e) => {
            e.stopPropagation();
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        initGrass();
        animate();
    </script>
</body>
</html>
