<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ðŸŒ¿ grass</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            height: 100vh;
            overflow: hidden;
            background: transparent;
            position: relative;
        }
        
        /* Green background - on the bottom layer */
        #greenBackground {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #b8c8a6, #8a9b7a);
            z-index: -2;
        }
        
        /* Early morning sun rays */
        #sunRays {
            position: fixed;
            top: -50%;
            right: -30%;
            width: 120%;
            height: 150%;
            background: conic-gradient(
                from 200deg at 100% 0%,
                transparent 0deg,
                rgba(255, 248, 220, 0.12) 5deg,
                transparent 10deg,
                transparent 15deg,
                rgba(255, 245, 200, 0.1) 20deg,
                transparent 25deg,
                transparent 32deg,
                rgba(255, 250, 230, 0.08) 37deg,
                transparent 42deg,
                transparent 50deg,
                rgba(255, 248, 210, 0.1) 55deg,
                transparent 60deg,
                transparent 70deg,
                rgba(255, 245, 200, 0.06) 75deg,
                transparent 80deg,
                transparent 360deg
            );
            z-index: -1;
            pointer-events: none;
            animation: sunRaysGlow 8s ease-in-out infinite;
        }
        
        @keyframes sunRaysGlow {
            0%, 100% {
                opacity: 0.7;
                transform: rotate(0deg);
            }
            50% {
                opacity: 1;
                transform: rotate(2deg);
            }
        }

        #grassCanvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
            cursor: pointer;
            will-change: transform;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }
        
        /* Clouds - BELOW grass, visible through gaps */
        #cloudsContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 500px;
            z-index: 0; /* BELOW grass */
            pointer-events: none;
        }
        
        .cloud {
            position: absolute;
            height: auto;
            opacity: 0.9;
            animation: cloudFloat linear infinite;
        }
        
        /* 30 clouds ABOVE â€” visible through grass gaps */
        .c1 { width: 600px; top: -200px; animation-duration: 280s; animation-delay: 0s; }
        .c2 { width: 700px; top: -180px; animation-duration: 320s; animation-delay: -20s; }
        .c3 { width: 550px; top: -220px; animation-duration: 260s; animation-delay: -40s; }
        .c4 { width: 650px; top: -160px; animation-duration: 300s; animation-delay: -60s; }
        .c5 { width: 580px; top: -210px; animation-duration: 290s; animation-delay: -80s; }
        .c6 { width: 720px; top: -170px; animation-duration: 340s; animation-delay: -100s; }
        .c7 { width: 500px; top: -190px; animation-duration: 250s; animation-delay: -120s; }
        .c8 { width: 680px; top: -150px; animation-duration: 310s; animation-delay: -140s; }
        .c9 { width: 560px; top: -205px; animation-duration: 270s; animation-delay: -160s; }
        .c10 { width: 640px; top: -175px; animation-duration: 295s; animation-delay: -180s; }
        .c11 { width: 600px; top: -195px; animation-duration: 285s; animation-delay: -200s; }
        .c12 { width: 710px; top: -155px; animation-duration: 330s; animation-delay: -220s; }
        .c13 { width: 520px; top: -185px; animation-duration: 255s; animation-delay: -240s; }
        .c14 { width: 660px; top: -165px; animation-duration: 305s; animation-delay: -260s; }
        .c15 { width: 570px; top: -215px; animation-duration: 275s; animation-delay: -280s; }
        .c16 { width: 630px; top: -145px; animation-duration: 315s; animation-delay: -300s; }
        .c17 { width: 590px; top: -198px; animation-duration: 265s; animation-delay: -320s; }
        .c18 { width: 690px; top: -162px; animation-duration: 325s; animation-delay: -340s; }
        .c19 { width: 540px; top: -188px; animation-duration: 258s; animation-delay: -360s; }
        .c20 { width: 670px; top: -202px; animation-duration: 308s; animation-delay: -380s; }
        .c21 { width: 610px; top: -152px; animation-duration: 288s; animation-delay: -400s; }
        .c22 { width: 730px; top: -192px; animation-duration: 335s; animation-delay: -420s; }
        .c23 { width: 510px; top: -172px; animation-duration: 252s; animation-delay: -440s; }
        .c24 { width: 650px; top: -208px; animation-duration: 298s; animation-delay: -460s; }
        .c25 { width: 595px; top: -148px; animation-duration: 282s; animation-delay: -480s; }
        .c26 { width: 700px; top: -182px; animation-duration: 322s; animation-delay: -500s; }
        .c27 { width: 530px; top: -212px; animation-duration: 262s; animation-delay: -520s; }
        .c28 { width: 660px; top: -158px; animation-duration: 302s; animation-delay: -540s; }
        .c29 { width: 565px; top: -195px; animation-duration: 272s; animation-delay: -560s; }
        .c30 { width: 680px; top: -178px; animation-duration: 312s; animation-delay: -580s; }
        
        @keyframes cloudFloat {
            from { transform: translateX(-100%); }
            to { transform: translateX(100vw); }
        }

        .pearl {
            position: fixed;
            width: 32px;
            height: 32px;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.95), rgba(240, 245, 240, 0.85));
            border-radius: 50%;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.15),
                0 0 15px rgba(255, 255, 255, 0.5);
            cursor: pointer;
            z-index: 10;
            transition: transform 0.15s ease;
            pointer-events: all;
            animation: pearlRise 1s ease-out forwards, pearlGlow 2.5s ease-in-out infinite;
            opacity: 0;
            will-change: transform, opacity;
        }

        .pearl:hover {
            transform: scale(1.2) !important;
        }

        .pearl:active {
            transform: scale(0.9) !important;
        }

        @keyframes pearlRise {
            0% {
                transform: translateY(100px) scale(0.3);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        @keyframes pearlGlow {
            0%, 100% {
                box-shadow: 
                    0 2px 8px rgba(0, 0, 0, 0.15),
                    0 0 15px rgba(255, 255, 255, 0.5);
            }
            50% {
                box-shadow: 
                    0 2px 8px rgba(0, 0, 0, 0.15),
                    0 0 25px rgba(255, 255, 200, 0.7);
            }
        }

        .pearl::before {
            content: '';
            position: absolute;
            top: 25%;
            left: 25%;
            width: 10px;
            height: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            filter: blur(2px);
        }

        #pearlModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 150;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #pearlModal.show {
            display: flex;
            opacity: 1;
        }

        #pearlContent {
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 50px 40px;
            border-radius: 32px;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            max-width: 420px;
            width: 90%;
            overflow: hidden;
            text-align: center;
            font-size: 20px;
            line-height: 1.6;
            color: #2a3a2a;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.4);
            transform: translateY(20px) scale(0.97);
            opacity: 0;
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1),
                        opacity 0.3s ease-out;
            will-change: transform, opacity;
        }

        #pearlModal.show #pearlContent {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        @keyframes modalEvaporate {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-40px) scale(1.08);
                opacity: 0;
            }
        }

        #pearlContent.evaporating {
            animation: modalEvaporate 0.5s cubic-bezier(0.4, 0, 1, 1) forwards;
        }

        #pearlText {
            font-weight: 500;
            white-space: pre-line;
            margin: 0;
        }

        #audioButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        #audioButton:active {
            transform: translateY(0);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        #closeModal {
            display: none;
        }

        /* Grass creatures */
        .creature {
            position: fixed;
            font-size: 24px;
            z-index: 5;
            pointer-events: none;
            user-select: none;
        }
        
        /* Transition only for rabbit (other creatures use opacity in animations) */
        .creature.rabbit {
            transition: opacity 0.3s ease;
        }

        .butterfly {
            width: 80px !important;
            height: 80px !important;
            font-size: 0 !important;
            animation: butterflyFly 4s ease-out forwards;
            pointer-events: none;
        }
        
        .butterfly-wings {
            width: 100%;
            height: 100%;
            background-image: url('Background/butterfly-with-folded-wings-on-a-gray-background.png?v=3');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            animation: butterflyWingFlap 0.25s ease-in-out infinite;
        }

        @keyframes butterflyFly {
            0% {
                transform: translate(0, 0) scale(0.5) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            25% {
                transform: translate(calc(var(--dx) * 0.25), calc(var(--dy) * 0.3 - 40px)) scale(0.85) rotate(-8deg);
                opacity: 1;
            }
            50% {
                transform: translate(calc(var(--dx) * 0.5), calc(var(--dy) * 0.5 - 20px)) scale(1) rotate(5deg);
                opacity: 1;
            }
            75% {
                transform: translate(calc(var(--dx) * 0.75), calc(var(--dy) * 0.8 + 30px)) scale(0.9) rotate(-3deg);
                opacity: 0.8;
            }
            90% {
                transform: translate(var(--dx), calc(var(--dy) + 60px)) scale(0.6) rotate(10deg);
                opacity: 0.4;
            }
            100% {
                transform: translate(calc(var(--dx) + 20px), calc(var(--dy) + 100px)) scale(0.3) rotate(15deg);
                opacity: 0;
            }
        }

        @keyframes butterflyWingFlap {
            0%, 100% { 
                transform: perspective(300px) rotateY(0deg) rotateX(0deg) scaleX(1);
                filter: brightness(1);
            }
            25% {
                transform: perspective(300px) rotateY(-35deg) rotateX(8deg) scaleX(0.85);
                filter: brightness(1.3);
            }
            50% { 
                transform: perspective(300px) rotateY(0deg) rotateX(0deg) scaleX(1);
                filter: brightness(1.5);
            }
            75% {
                transform: perspective(300px) rotateY(35deg) rotateX(-8deg) scaleX(0.85);
                filter: brightness(1.3);
            }
        }

        .firefly {
            width: 45px !important;
            height: 45px !important;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            font-size: 0 !important;
            animation: fireflyRise var(--duration) ease-in-out forwards, fireflyGlow 1.2s ease-in-out infinite;
        }
        
        /* 4 different star shapes */
        .firefly-red {
            background-image: url('Background/Layer-2.png?v=2');
            width: 35px !important;
            height: 65px !important; /* Vertical */
        }
        .firefly-cyan {
            background-image: url('Background/Layer-3.png?v=2');
            width: 50px !important;
            height: 70px !important; /* Vertical */
        }
        .firefly-blue {
            background-image: url('Background/Layer-4.png?v=2');
            width: 45px !important;
            height: 45px !important; /* Square */
        }
        .firefly-small-blue {
            background-image: url('Background/Layer-5.png?v=2');
            width: 35px !important;
            height: 35px !important; /* Small square */
        }

        @keyframes fireflyRise {
            0% {
                transform: translate(0, 0) scale(0.3);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            30% {
                transform: translate(calc(var(--dx) * 0.3), calc(var(--dy) * 0.4)) scale(0.8);
            }
            60% {
                transform: translate(calc(var(--dx) * 0.7), calc(var(--dy) * 0.6)) scale(1.1);
            }
            100% {
                transform: translate(var(--dx), var(--dy)) scale(0.7);
                opacity: 0;
            }
        }

        @keyframes fireflyGlow {
            0%, 100% { 
                filter: brightness(1);
                text-shadow: 0 0 8px rgba(255, 255, 150, 0.8);
            }
            50% { 
                filter: brightness(1.6);
                text-shadow: 0 0 16px rgba(255, 255, 150, 1);
            }
        }

        .grasshopper {
            width: 70px !important;
            height: 55px !important; /* Horizontal */
            background-image: url('Background/grasshopper-on-a-gray-background.png?v=2');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            font-size: 0 !important;
            animation: grasshopperJump 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        
        .ladybug {
            width: 45px !important;
            height: 35px !important;
            background-image: url('Background/ladybug.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            font-size: 0 !important;
            animation: ladybugCrawl 8s ease-in-out forwards;
        }
        
        @keyframes ladybugCrawl {
            0% {
                transform: translate(-60px, 0) scale(0.6);
                opacity: 0;
            }
            10% {
                transform: translate(-30px, -5px) scale(0.7);
                opacity: 1;
            }
            25% {
                transform: translate(0, -10px) scale(0.8);
                opacity: 1;
            }
            /* Sitting on a leaf */
            40%, 60% {
                transform: translate(10px, -15px) scale(0.85);
                opacity: 1;
            }
            /* Small movement while sitting */
            50% {
                transform: translate(12px, -14px) scale(0.85) rotate(5deg);
            }
            /* Crawling back */
            75% {
                transform: translate(-10px, -8px) scale(0.75);
                opacity: 1;
            }
            90% {
                transform: translate(-40px, 0) scale(0.65);
                opacity: 0.5;
            }
            100% {
                transform: translate(-70px, 5px) scale(0.5);
                opacity: 0;
            }
        }

        .alien {
            width: 250px !important;
            height: 250px !important;
            font-size: 0 !important;
            position: fixed;
            left: 0;
            top: 0;
            background-image: url('Background/cute-friendly-alien-character--vaguely-reminiscent (4).png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            z-index: 250;
            opacity: 0;
            transition: opacity 0.5s ease;
            will-change: transform;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            transform: translate3d(0, 0, 0);
        }

        @keyframes grasshopperJump {
            0% {
                /* On the ground, preparing to jump */
                transform: translate(0, 0) scale(calc(0.9 * var(--flip, 1)), 0.9) rotate(0deg);
                opacity: 0;
            }
            5% {
                /* Crouching before jump */
                transform: translate(0, 5px) scale(calc(0.85 * var(--flip, 1)), 0.85) rotate(calc(-5deg * var(--flip, 1)));
                opacity: 1;
            }
            15% {
                /* Pushing off! */
                transform: translate(calc(var(--dx) * 0.15), -30px) scale(calc(1 * var(--flip, 1)), 1) rotate(calc(15deg * var(--flip, 1)));
                opacity: 1;
            }
            30% {
                /* Flying up in an arc */
                transform: translate(calc(var(--dx) * 0.35), -80px) scale(calc(1.05 * var(--flip, 1)), 1.05) rotate(calc(25deg * var(--flip, 1)));
                opacity: 1;
            }
            50% {
                /* PEAK of jump - maximum height! */
                transform: translate(calc(var(--dx) * 0.55), -100px) scale(calc(1.1 * var(--flip, 1)), 1.1) rotate(calc(30deg * var(--flip, 1)));
                opacity: 1;
            }
            65% {
                /* Falling down in an arc */
                transform: translate(calc(var(--dx) * 0.7), -70px) scale(calc(1.05 * var(--flip, 1)), 1.05) rotate(calc(25deg * var(--flip, 1)));
                opacity: 1;
            }
            80% {
                /* Descending to ground */
                transform: translate(calc(var(--dx) * 0.85), -20px) scale(calc(1 * var(--flip, 1)), 1) rotate(calc(15deg * var(--flip, 1)));
                opacity: 1;
            }
            90% {
                /* Almost landed */
                transform: translate(calc(var(--dx) * 0.95), 0px) scale(calc(0.95 * var(--flip, 1)), 0.95) rotate(calc(5deg * var(--flip, 1)));
                opacity: 0.8;
            }
            100% {
                /* Landed and disappearing into grass */
                transform: translate(var(--dx), 10px) scale(calc(0.7 * var(--flip, 1)), 0.7) rotate(0deg);
                opacity: 0;
            }
        }

        /* Rabbit - large, peeking from below */
        .rabbit {
            width: 640px !important;
            height: 640px !important;
            background-image: url('Background/front-facing-rabbit-sitting-upright--full-body-cen (2).png?v=2');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            font-size: 0 !important;
            animation: rabbitPeek 3s ease-in-out forwards;
            filter: drop-shadow(0 4px 15px rgba(0, 0, 0, 0.25));
        }

        @keyframes rabbitPeek {
            0% {
                transform: translateY(0px) rotate(0deg); /* starts at bottom of screen */
                opacity: 0;
            }
            15% {
                opacity: 1;
                transform: translateY(calc(-0.3 * var(--rabbit-peek-height, 120px))) rotate(0deg);
            }
            /* Ear twitch - small rotations */
            25% {
                transform: translateY(calc(-0.8 * var(--rabbit-peek-height, 120px))) rotate(1.5deg);
            }
            30% {
                transform: translateY(calc(-1 * var(--rabbit-peek-height, 120px))) rotate(-1deg);
            }
            35% {
                transform: translateY(calc(-1 * var(--rabbit-peek-height, 120px))) rotate(1deg);
            }
            40% {
                transform: translateY(calc(-1 * var(--rabbit-peek-height, 120px))) rotate(-0.5deg);
            }
            45%, 60% {
                transform: translateY(calc(-1 * var(--rabbit-peek-height, 120px))) rotate(0deg);
                opacity: 1;
            }
            /* One more twitch before leaving */
            65% {
                transform: translateY(calc(-1 * var(--rabbit-peek-height, 120px))) rotate(1deg);
            }
            70% {
                transform: translateY(calc(-1 * var(--rabbit-peek-height, 120px))) rotate(-0.5deg);
            }
            75% {
                transform: translateY(calc(-0.8 * var(--rabbit-peek-height, 120px))) rotate(0deg);
            }
            100% {
                transform: translateY(0px) rotate(0deg); /* goes back down */
                opacity: 0;
            }
        }

        /* Focus indicator / timer */
        #focusTimer {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 150;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s ease;
            pointer-events: auto;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        #focusTimer:hover {
            opacity: 1;
        }
        
        .timer-circle {
            width: 70px;
            height: 70px;
            position: relative;
        }
        
        .timer-circle svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg) scaleX(-1);
        }
        
        .timer-bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.3);
            stroke-width: 4;
        }
        
        .timer-progress {
            fill: none;
            stroke: rgba(255, 255, 255, 0.9);
            stroke-width: 4;
            stroke-linecap: round;
            stroke-dasharray: 283; /* 2 * PI * 45 */
            stroke-dashoffset: 283; /* Start with empty circle */
            transition: stroke-dashoffset 1s linear;
        }
        
        .timer-label {
            font-family: 'Georgia', serif;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 2px;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        
        #focusTimer.running .timer-label {
            color: rgba(180, 255, 180, 0.9);
        }
        
        #focusTimer.paused .timer-progress {
            stroke: rgba(255, 200, 100, 0.9);
        }

        @media (max-width: 600px) {
            #pearlContent {
                max-width: 90%;
                padding: 25px 20px;
                font-size: 16px;
                margin: 10px;
                backdrop-filter: blur(8px);
                -webkit-backdrop-filter: blur(8px);
            }
            
            /* Fix images in cards on mobile */
            #pearlImage {
                width: calc(100% + 40px) !important;
                height: 220px !important;
                margin: -25px -20px 15px -20px !important;
                border-radius: 12px 12px 0 0 !important;
                object-fit: cover;
                object-position: center;
            }
            
            #pearlImageCredit {
                font-size: 8px !important;
                padding: 3px 6px !important;
                bottom: 5px !important;
                right: 5px !important;
            }
            
            #pearlCaption {
                font-size: 0.8em !important;
            }
            
            #audioButton {
                padding: 10px 18px !important;
                font-size: 14px !important;
            }
            
            .pearl {
                width: 28px;
                height: 28px;
            }
            .creature {
                font-size: 20px;
            }
            .butterfly {
                width: 55px !important;
                height: 55px !important;
            }
            .rabbit {
                width: 320px !important;
                height: 320px !important;
            }
            .firefly {
                width: 35px !important;
                height: 35px !important;
            }
            .firefly-red {
                width: 25px !important;
                height: 45px !important;
            }
            .firefly-cyan {
                width: 35px !important;
                height: 50px !important;
            }
            .firefly-small-blue {
                width: 25px !important;
                height: 25px !important;
            }
            .grasshopper {
                width: 50px !important;
                height: 45px !important;
            }
            .ladybug {
                width: 35px !important;
                height: 28px !important;
            }
        }
    </style>
</head>
<body>
    <!-- Green background - bottom layer -->
    <div id="greenBackground"></div>
    
    <!-- Early morning sun rays -->
    <div id="sunRays"></div>
    
    <canvas id="grassCanvas"></canvas>
    
    <!-- Floating clouds (lots!) -->
    <div id="cloudsContainer">
        <img src="Background/cloud1.png" class="cloud c1" alt="">
        <img src="Background/cloud2.png" class="cloud c2" alt="">
        <img src="Background/cloud1.png" class="cloud c3" alt="">
        <img src="Background/cloud2.png" class="cloud c4" alt="">
        <img src="Background/cloud1.png" class="cloud c5" alt="">
        <img src="Background/cloud2.png" class="cloud c6" alt="">
        <img src="Background/cloud1.png" class="cloud c7" alt="">
        <img src="Background/cloud2.png" class="cloud c8" alt="">
        <img src="Background/cloud1.png" class="cloud c9" alt="">
        <img src="Background/cloud2.png" class="cloud c10" alt="">
        <img src="Background/cloud1.png" class="cloud c11" alt="">
        <img src="Background/cloud2.png" class="cloud c12" alt="">
        <img src="Background/cloud1.png" class="cloud c13" alt="">
        <img src="Background/cloud2.png" class="cloud c14" alt="">
        <img src="Background/cloud1.png" class="cloud c15" alt="">
        <img src="Background/cloud2.png" class="cloud c16" alt="">
        <img src="Background/cloud1.png" class="cloud c17" alt="">
        <img src="Background/cloud2.png" class="cloud c18" alt="">
        <img src="Background/cloud1.png" class="cloud c19" alt="">
        <img src="Background/cloud2.png" class="cloud c20" alt="">
        <img src="Background/cloud1.png" class="cloud c21" alt="">
        <img src="Background/cloud2.png" class="cloud c22" alt="">
        <img src="Background/cloud1.png" class="cloud c23" alt="">
        <img src="Background/cloud2.png" class="cloud c24" alt="">
        <img src="Background/cloud1.png" class="cloud c25" alt="">
        <img src="Background/cloud2.png" class="cloud c26" alt="">
        <img src="Background/cloud1.png" class="cloud c27" alt="">
        <img src="Background/cloud2.png" class="cloud c28" alt="">
        <img src="Background/cloud1.png" class="cloud c29" alt="">
        <img src="Background/cloud2.png" class="cloud c30" alt="">
    </div>
    
    <!-- Focus indicator / timer (hidden) -->
    <!--
    <div id="focusTimer">
        <div class="timer-circle">
            <svg viewBox="0 0 100 100">
                <circle class="timer-bg" cx="50" cy="50" r="45"/>
                <circle class="timer-progress" cx="50" cy="50" r="45"/>
            </svg>
        </div>
        <div class="timer-label">rest</div>
    </div>
    -->
    
    <!-- Saturn background (shown when Saturn card is open) -->
    <div id="saturnBackground" style="display: none; opacity: 0; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: black; z-index: 200; cursor: pointer; transition: opacity 0.35s ease;">
        <img id="saturnImage" style="display:none; opacity:0; width:100%; height:100%; object-fit:cover; transition: opacity 0.35s ease; background:black;" />
    </div>

    <div id="pearlModal">
        <div id="pearlContent">
            <div style="position: relative;">
                <img id="pearlImage" style="display:none; width: calc(100% + 80px); height: 220px; object-fit: cover; border-radius: 16px; margin: -50px -40px 20px -40px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);" />
                <div id="pearlImageCredit" style="display:none; position: absolute; bottom: 10px; right: 10px; font-size: 9px; color: rgba(255, 255, 255, 0.7); background: rgba(0, 0, 0, 0.4); padding: 4px 8px; border-radius: 4px; font-family: Arial, sans-serif;"></div>
            </div>
            <div id="pearlText"></div>
            <div id="pearlCaption" style="display:none; margin-top: 10px; font-size: 0.9em; opacity: 0.8; font-style: italic;"></div>
            <button id="audioButton" style="display:none; margin-top: 20px; padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 25px; font-size: 16px; cursor: pointer; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); transition: all 0.3s ease;"></button>
            <button id="closeModal">ðŸŒ¿</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('grassCanvas');
        const ctx = canvas.getContext('2d');
        const modal = document.getElementById('pearlModal');
        const pearlText = document.getElementById('pearlText');
        const pearlImage = document.getElementById('pearlImage');
        const pearlCaption = document.getElementById('pearlCaption');
        const pearlImageCredit = document.getElementById('pearlImageCredit');
        const audioButton = document.getElementById('audioButton');
        const closeBtn = document.getElementById('closeModal');
        const saturnBackground = document.getElementById('saturnBackground');
        
        let currentAudio = null; // For storing current audio
        let alienElement = null; // For storing alien element
        let alienAnimationId = null; // For requestAnimationFrame
        let alienResizeHandler = null; // For resize listener
        let isSpaceMode = false; // Space mode (Saturn)

        // Retina/high DPI support for sharp grass on mobile
        const dpr = window.devicePixelRatio || 1;
        let width = window.innerWidth;
        let height = window.innerHeight;
        
        // Set canvas size with DPI in mind
        canvas.width = width * dpr;
        canvas.height = height * dpr;
        canvas.style.width = width + 'px';
        canvas.style.height = height + 'px';
        ctx.scale(dpr, dpr);
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = 'high';
        
        let grass = [];
        let touchPos = null;
        let windTime = 0;

        let wisdoms = [
            "drink some water",
            "relax your jaw",
            "take a deep breath in and out",
            "put your phone down, look into the distance for 20 sec",
            "stretch like a cat",
            "stand up for a minute",
            "take a 10-minute walk outside",
            "think about your dream for 2 minutes, stay focused",
            "find 3 pleasant little things around you",
            "mentally say 'thank you' to yourself",
            "it's all good: you're alive",
            "tired? take a rest",
            "imagine your breath as waves",
            "be gentle with yourself",
            "imagine you're a cat in the sun",
            "eat something green, like an apple or avocado",
            "stand by the window for 2 minutes",
            "imagine you're a star: just shining",
            "relax your belly",
            "look at something green",
            "listen to your heartbeat",
            "what are you feeling right now?",
            "choose kindness",
            "don't overthink it, just start",
            "a small win is still a win",
            "massage your earlobes",
            "be a tree: grounded and calm",
            "if you were a planet, which one would you be?",
            "wiggle your toes",
            "roll your shoulders in circles",
            "let your anxiety float away on a raft",
            "you're a flower, just existing and swaying in the wind",
            "close your eyes for 30 seconds",
            "look at yourself from above the clouds",
            "what did you accomplish today?",
            "mentally send your stress to another galaxy",
            "you're doing great, even if you don't feel it",
            "you're already coping",
            "making mistakes is normal",
            "be the grass: sway and rustle",
            "imagine sitting in the soft palm of a kind creature",
            "tiredness is not weakness",
            "rest is not laziness, it's necessary",
            "bad days happen to everyone",
            "think kindly about someone",
            "imagine you're a cloud",
            "let your thoughts be clouds: drifting gently",
            "mentally send all your problems into space",
            "imagine your thoughts are bubbles floating away",
            "imagine you're a warm little bun",
            "be a leaf in the wind"
        ];

        // Visual facts with images
        let visualFacts = [
            {
                fact: "Sea otters hold hands while sleeping so they don't drift apart",
                caption: "",
                imageUrl: "Background/two-sea-otters-sleeping-on-their-backs--floating-t.png"
            },
            {
                fact: "In Japan, there's a concept called 'forest bathing' (shinrin-yoku) â€” therapy through forest walks",
                caption: "20 minutes in the forest reduces cortisol",
                imageUrl: "Background/wide_top-down_shot_orthographic_feel_no_foreshortening_a_giant_man_in_a_grey_tracksuit_lies_flat_on_lwmfulmv6av7wwacln02_0.png"
            },
            {
                fact: "Scientists recorded the sound of Saturn: it sounds like alien music",
                caption: "planets have their own soundtracks",
                imageUrl: "Background/hubble-saturn-visible-light.jpg",
                imageCredit: "Image credit: NASA",
                audioUrl: "123163main_casskr1112203.mp3",
                audioButtonText: "ðŸ”Š listen to Saturn's sound"
            },
            {
                fact: "Your body is made of stardust",
                caption: "literally. all atoms heavier than hydrogen were born in stars",
                imageUrl: "Background/ancient_stardust.png",
                imageCredit: "Image credit: NASA"
            },
            {
                fact: "20 minutes in nature reduces stress levels by 20%",
                caption: "nature is a free therapist",
                imageUrl: "Background/Screenshot 2025-11-14 at 19.02.06.png"
            },
            {
                fact: "The Japanese art of kintsugi is repairing ceramics with gold",
                caption: "sometimes cracks make things more valuable",
                imageUrls: [
                    "Background/beautiful_adult_woman_natural_human_skin_eyes_closed_serene_expression_waist-up_no_statue_cutoff_no_g8oy0npkeh95sn1dim0b_1.png",
                    "Background/full-length_seated_beautiful_woman_adult_on_simple_chair_relaxed_posture_hands_on_lap_continuous_bo_shul4hff6l0lnz781q69_2.png"
                ]
            }
        ];

        let activePearls = [];
        let touchMoveDistance = 0;
        let lastTouchPos = null;
        let touchStartTime = 0;
        let touchCounter = 0; // Movement counter for creature appearance
        
        // Track shown cards (to avoid repetition)
        let shownWisdoms = []; // Shown text wisdoms (actual strings)
        let shownVisualFacts = []; // Shown visual facts (actual objects)
        let lastShownWisdom = null; // Last shown wisdom to prevent repeats
        let lastShownFact = null; // Last shown fact to prevent repeats
        let cardsShownCount = 0; // Counter of shown cards (for rabbit)
        
        // === TWO-LAYER SOUND SYSTEM ===
        // Layer 1: Web Audio API â€” synthesized sounds (cosmic)
        let audioContext;
        let windSound;
        let isTouching = false;

        // Layer 2: HTML5 Audio â€” real nature recordings (background ambient)
        let ambientAudio = null;
        let audioInitialized = false;
        let creaturesStarted = false; // Separate flag for creatures

        const AMBIENT_SOUNDS = [
            "https://assets.mixkit.co/active_storage/sfx/2458/2458.wav", // birds + wind
            "https://assets.mixkit.co/active_storage/sfx/513/513.wav"     // nature ambience
        ];

        // Initialize Audio Context (synthesized sounds)
        function initAudio() {
            if (audioInitialized) return;
            audioInitialized = true;

            // Web Audio API for synthesized sounds
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                createWindSound();
                createBirdSounds();
            }
            
            // Start creatures separately (even if audio is blocked)
            if (!creaturesStarted) {
                creaturesStarted = true;
                startIdleCreatures();
            }

            // HTML5 Audio for background atmosphere with ducks
            if (!ambientAudio) {
                ambientAudio = new Audio(AMBIENT_SOUNDS[0]);
                ambientAudio.loop = true;
                ambientAudio.volume = 0.20; // louder
                ambientAudio.crossOrigin = "anonymous";
                
                // Try to start immediately
                const playPromise = ambientAudio.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        console.log('ðŸ¦† Ducks playing!');
                    }).catch(error => {
                        console.log('âš ï¸ Ducks blocked by browser:', error.name);
                        // Try again after one second
                        setTimeout(() => {
                            ambientAudio.play().catch(() => {});
                        }, 1000);
                    });
                }
            }
        }

        // Create background synthesized wind sound with waves
        let windGainNode; // save reference for animation
        
        function createWindSound() {
            const bufferSize = audioContext.sampleRate * 2;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const data = buffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                data[i] = (Math.random() * 2 - 1) * 0.05;
            }
            
            windSound = audioContext.createBufferSource();
            windSound.buffer = buffer;
            windSound.loop = true;
            
            windGainNode = audioContext.createGain();
            windGainNode.gain.value = 0.08;
            
            const windFilter = audioContext.createBiquadFilter();
            windFilter.type = 'lowpass';
            windFilter.frequency.value = 800;
            
            windSound.connect(windFilter);
            windFilter.connect(windGainNode);
            windGainNode.connect(audioContext.destination);
            
            windSound.start(0);
            
            // Wind waves - blowing and calming
            function windWave() {
                if (!windGainNode) return;
                // Don't play wind waves in space mode
                if (isSpaceMode) {
                    setTimeout(windWave, 1000); // Check again after one second
                    return;
                }
                const duration = 5 + Math.random() * 3; // 5-8 sec
                const target = 0.06 + Math.random() * 0.10; // 0.06-0.16
                const now = audioContext.currentTime;
                windGainNode.gain.linearRampToValueAtTime(target, now + duration / 2);
                windGainNode.gain.linearRampToValueAtTime(0.05, now + duration);
                setTimeout(windWave, duration * 1000);
            }
            windWave();
        }

        // Create synthesized bird sounds
        function createBirdSounds() {
            // First bird immediately!
            setTimeout(() => {
                if (audioContext) playBirdChirp();
            }, 1000);
            
            // Then regularly every 5 seconds
            setInterval(() => {
                if (audioContext) {
                    playBirdChirp();
                }
            }, 5000);
        }

        // Removed monotonous crickets - replaced with random grasshoppers

        function playBirdChirp() {
            // Don't play birds during space sequence
            if (isSpaceMode) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.type = 'sine';
            oscillator.frequency.value = 2000 + Math.random() * 1000;
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.15, audioContext.currentTime + 0.01); // louder
            gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.15);
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.15);
        }


        // Magical cosmic sound when pearl appears
        function playPearlAppearSound() {
            if (!audioContext) return;
            
            const oscillator1 = audioContext.createOscillator();
            const oscillator2 = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator1.type = 'sine';
            oscillator1.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator1.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.3);
            
            oscillator2.type = 'sine';
            oscillator2.frequency.setValueAtTime(1200, audioContext.currentTime);
            oscillator2.frequency.exponentialRampToValueAtTime(1600, audioContext.currentTime + 0.3);
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.05);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator1.connect(gainNode);
            oscillator2.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator1.start(audioContext.currentTime);
            oscillator2.start(audioContext.currentTime);
            oscillator1.stop(audioContext.currentTime + 0.3);
            oscillator2.stop(audioContext.currentTime + 0.3);
        }

        // Digital grass sound on touch
        function playGrassRustleSound() {
            if (!audioContext || isSpaceMode) return; // Don't play in space
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();
            
            oscillator.type = 'brown';
            filter.type = 'bandpass';
            filter.frequency.value = 400 + Math.random() * 300;
            filter.Q.value = 2;
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.08, audioContext.currentTime + 0.02);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            
            oscillator.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.2);
        }

        // Butterfly sound
        function playButterflySound() {
            if (!audioContext || isSpaceMode) return; // Don't play in space
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(800, audioContext.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1400, audioContext.currentTime + 0.15);
            gain.gain.setValueAtTime(0, audioContext.currentTime);
            gain.gain.linearRampToValueAtTime(0.05, audioContext.currentTime + 0.02);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + 0.15);
        }

        // Firefly sound
        function playFireflySound() {
            if (!audioContext || isSpaceMode) return; // Don't play in space
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.type = 'sine';
            osc.frequency.value = 1800;
            gain.gain.setValueAtTime(0, audioContext.currentTime);
            gain.gain.linearRampToValueAtTime(0.03, audioContext.currentTime + 0.05);
            gain.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.3);
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + 0.3);
        }

        // Grasshopper sound
        function playGrasshopperSound() {
            if (!audioContext || isSpaceMode) return; // Don't play in space
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.type = 'square';
            osc.frequency.value = 3000 + Math.random() * 1000;
            gain.gain.setValueAtTime(0, audioContext.currentTime);
            gain.gain.linearRampToValueAtTime(0.06, audioContext.currentTime + 0.01);
            gain.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.08);
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + 0.08);
        }

        // === PNG GRASS BLADES ===
        // Load 8 grass images
        const grassImages = [];
        let grassImagesLoaded = false;
        
        // === WIND GUST SYSTEM ===
        let windGust = 0;           // Current gust strength (0 = no gust)
        let windGustTarget = 0;     // Target gust strength
        let windGustDirection = 1;  // Gust direction (1 = right, -1 = left)
        let windGustX = 0;          // Wind "wave" position on X
        
        // Wind gusts DISABLED - only gentle swaying
        function startWindGusts() {
            // Disabled
        }
        
        function updateWindGust() {
            // Disabled - no wind gusts
            windGust = 0;
            windGustTarget = 0;
        }
        
        startWindGusts();
        
        // === FLOWERS, CLOVER AND DANDELIONS ===
        const flowerImage = new Image();
        const cloverImage = new Image();
        const dandelionImage = new Image();
        let flowersLoaded = false;
        let imagesLoadedCount = 0;
        
        function onFlowerImageLoad() {
            imagesLoadedCount++;
            if (imagesLoadedCount >= 3) {
                flowersLoaded = true;
                initFlowers();
            }
        }
        
        flowerImage.onload = () => {
            console.log('ðŸŒ¸ Flower loaded!');
            onFlowerImageLoad();
        };
        cloverImage.onload = () => {
            console.log('ðŸ€ Clover loaded!');
            onFlowerImageLoad();
        };
        dandelionImage.onload = () => {
            console.log('ðŸŒ¼ Dandelion loaded!');
            onFlowerImageLoad();
        };
        
        flowerImage.src = 'Background/a_single_bellflower_on_a_curved_stem_side_view_one_main_bell-shaped_blossom_and_one_small_bud_petal_8d8r645g1pjtms25s1lz_1.png';
        cloverImage.src = 'Background/a_single_clover_plant_with_three_or_four_heart-shaped_leaves_slight_top-down_angle_so_all_leaves_ar_qgcin7cizj3oiqwvugwx_1.png';
        dandelionImage.src = 'Background/a_single_dandelion_flower_on_a_straight_thin_stem_side_view_fluffy_yellow_petals_simplified_into_cl_rtegyivy8a619uxci8w7_0 (1).png';
        
        let flowers = []; // Array of flowers, clover and dandelions
        
        function checkFlowersLoaded() {
            if (flowerImage.complete && cloverImage.complete && dandelionImage.complete) {
                flowersLoaded = true;
                initFlowers();
            }
        }
        
        function initFlowers() {
            flowers = [];
            
            // Check for mobile device (small screen)
            const isMobile = width < 768;
            
            // On mobile increase count and size
            const flowerCount = isMobile ? (10 + Math.floor(Math.random() * 6)) : (6 + Math.floor(Math.random() * 5));
            const cloverCount = isMobile ? (25 + Math.floor(Math.random() * 10)) : (15 + Math.floor(Math.random() * 8));
            const scaleMultiplier = isMobile ? 1.5 : 1; // Increase size on mobile
            
            // Flowers â€” across the field
            for (let i = 0; i < flowerCount; i++) {
                flowers.push({
                    type: 'flower',
                    x: Math.random() * width,
                    y: height * 0.35 + Math.random() * height * 0.55, // Across the field
                    scale: (0.13 + Math.random() * 0.08) * scaleMultiplier, // 30% smaller
                    windPhase: Math.random() * Math.PI * 2,
                    bendAmount: 0
                });
            }
            
            // Clover â€” AT THE TOP of the page, where gaps are visible
            for (let i = 0; i < cloverCount; i++) {
                flowers.push({
                    type: 'clover',
                    x: Math.random() * width,
                    y: height * 0.10 + Math.random() * height * 0.45, // Expanded zone (10%-55%)
                    scale: (0.14 + Math.random() * 0.13) * scaleMultiplier, // 30% smaller
                    windPhase: Math.random() * Math.PI * 2,
                    bendAmount: 0
                });
            }
            
            // Dandelions â€” more on mobile
            const dandelionCount = isMobile ? (8 + Math.floor(Math.random() * 4)) : (5 + Math.floor(Math.random() * 2));
            for (let i = 0; i < dandelionCount; i++) {
                flowers.push({
                    type: 'dandelion',
                    x: width * 0.1 + Math.random() * width * 0.8, // Evenly across width
                    y: height * 0.4 + Math.random() * height * 0.5, // Middle and bottom part
                    scale: (0.18 + Math.random() * 0.11) * scaleMultiplier, // 30% smaller
                    windPhase: Math.random() * Math.PI * 2,
                    bendAmount: 0
                });
            }
            
            // Sort by Y for correct layering
            flowers.sort((a, b) => a.y - b.y);
            console.log(`ðŸŒ¸ Created ${flowerCount} flowers, ${cloverCount} clovers and ${dandelionCount} dandelions`);
        }
        
        function updateFlowers() {
            if (!flowersLoaded) return;
            
            flowers.forEach(f => {
                // Swaying like grass
                const baseWind = Math.sin(windTime * 0.2 + f.windPhase) * 0.02;
                let gustForce = 0;
                const distFromGust = Math.abs(f.x - windGustX);
                if (distFromGust < 250) {
                    gustForce = windGust * (1 - distFromGust / 250) * windGustDirection;
                }
                const targetBend = baseWind + gustForce;
                f.bendAmount += (targetBend - f.bendAmount) * 0.06;
            });
        }
        
        function drawSingleFlower(f) {
            if (!flowersLoaded) return;
            
            let img;
            if (f.type === 'flower') img = flowerImage;
            else if (f.type === 'clover') img = cloverImage;
            else if (f.type === 'dandelion') img = dandelionImage;
            else return;
            const w = img.width * f.scale;
            const h = img.height * f.scale;
            
            ctx.save();
            ctx.translate(f.x, f.y);
            ctx.transform(1, 0, f.bendAmount, 1, 0, 0);
            ctx.drawImage(img, -w / 2, -h, w, h);
            ctx.restore();
        }
        
        // === FLOATING CLOUDS (background) ===
        const cloudImages = [new Image(), new Image()];
        let cloudsLoaded = 0;
        let clouds = [];
        
        cloudImages[0].onload = () => { 
            cloudsLoaded++; 
            console.log('â˜ï¸ Cloud 1 loaded');
            if (cloudsLoaded === 2) initClouds(); 
        };
        cloudImages[1].onload = () => { 
            cloudsLoaded++; 
            console.log('â˜ï¸ Cloud 2 loaded');
            if (cloudsLoaded === 2) initClouds(); 
        };
        cloudImages[0].onerror = () => console.error('âŒ Error loading cloud 1');
        cloudImages[1].onerror = () => console.error('âŒ Error loading cloud 2');
        
        cloudImages[0].src = 'Background/cloud1.png';
        cloudImages[1].src = 'Background/cloud2.png';
        
        function initClouds() {
            clouds = [];
            // Create 2-3 VERY LARGE clouds (as in the design)
            const numClouds = 2 + Math.floor(Math.random() * 2);
            for (let i = 0; i < numClouds; i++) {
                clouds.push({
                    x: -200 + i * (width / 2) + Math.random() * 300, // Distribute
                    y: -100 + Math.random() * 150, // From -100 to +50 (partially above top)
                    imageIndex: Math.floor(Math.random() * 2),
                    scale: 2.5 + Math.random() * 1.5, // 2.5-4.0 (HUGE as in design!)
                    speed: 0.05 + Math.random() * 0.05, // Very slow
                    alpha: 0.95 // Well visible
                });
            }
            console.log(`â˜ï¸ Created ${numClouds} HUGE clouds`, clouds);
        }
        
        // Initialize clouds immediately (in case images are already cached)
        setTimeout(() => {
            if (clouds.length === 0 && cloudsLoaded === 2) {
                initClouds();
            }
        }, 500);
        
        function updateClouds() {
            if (clouds.length === 0) return;
            
            for (let i = 0; i < clouds.length; i++) {
                const cloud = clouds[i];
                cloud.x += cloud.speed;
                
                // If cloud went past right edge â€” return from left
                const img = cloudImages[cloud.imageIndex];
                if (!img || !img.complete) continue;
                const w = img.width * cloud.scale;
                if (cloud.x > width + w / 2) {
                    cloud.x = -w * 1.2;
                    cloud.y = -100 + Math.random() * 150; // Same as initialization
                }
            }
        }
        
        function drawClouds() {
            if (cloudsLoaded < 2 || clouds.length === 0) {
                return;
            }
            
            for (let i = 0; i < clouds.length; i++) {
                const cloud = clouds[i];
                const img = cloudImages[cloud.imageIndex];
                if (!img || !img.complete || !img.naturalWidth) continue;
                
                const w = img.naturalWidth * cloud.scale;
                const h = img.naturalHeight * cloud.scale;
                
                ctx.save();
                ctx.globalAlpha = cloud.alpha;
                ctx.drawImage(img, cloud.x - w / 2, cloud.y, w, h);
                ctx.restore();
            }
        }
        
        // Cloud debug log
        setTimeout(() => {
            console.log('â˜ï¸ Cloud status:', {
                cloudsLoaded,
                cloudsCount: clouds.length,
                img0: cloudImages[0].complete ? 'OK' : 'FAIL',
                img1: cloudImages[1].complete ? 'OK' : 'FAIL',
                clouds: clouds
            });
        }, 2000);
        
        // === FLYING BIRD (3 animation frames) ===
        const birdImages = [new Image(), new Image(), new Image()];
        let birdImagesLoaded = 0;
        let birdLoaded = false;
        let bird = null; // Current bird (or null if not flying)
        
        birdImages.forEach((img, i) => {
            img.onload = () => {
                birdImagesLoaded++;
                if (birdImagesLoaded === 3) {
                    birdLoaded = true;
                    console.log('ðŸ¦ All 3 bird frames loaded!');
                    startBirdTimer();
                }
            };
            img.src = `Background/bird${i + 1}.png`;
        });
        
        function startBirdTimer() {
            // Sparrow flies â€” every 45-75 seconds (much less frequent)
            setInterval(() => {
                // Don't spawn in space mode
                if (isSpaceMode) return;
                
                if (!bird && Math.random() > 0.5) { // 50% chance
                    spawnBird();
                }
            }, 45000 + Math.random() * 30000); // Check every 45-75 seconds
            
            // First bird 8-15 seconds after loading
            setTimeout(() => {
                if (!bird && !isSpaceMode) spawnBird();
            }, 8000 + Math.random() * 7000);
        }
        
        function spawnBird() {
            // Random trajectory type
            const trajectoryType = Math.floor(Math.random() * 4);
            
            let startX, startY, vx, vy, dir;
            
            switch (trajectoryType) {
                case 0: // Takes off UP from grass (original)
                    startX = width * 0.2 + Math.random() * width * 0.6;
                    startY = height * 0.85;
                    vx = (Math.random() - 0.5) * 3;
                    vy = -(6 + Math.random() * 4);
                    dir = vx > 0 ? 1 : -1;
                    console.log('ðŸ¦ Sparrow takes off from grass! â†‘');
                    break;
                case 1: // Flies across from LEFT to RIGHT
                    startX = -80;
                    startY = height * 0.15 + Math.random() * height * 0.35;
                    vx = 6 + Math.random() * 4;
                    vy = (Math.random() - 0.5) * 2;
                    dir = 1;
                    console.log('ðŸ¦ Bird flies left â†’ right');
                    break;
                case 2: // Flies across from RIGHT to LEFT
                    startX = width + 80;
                    startY = height * 0.15 + Math.random() * height * 0.35;
                    vx = -(6 + Math.random() * 4);
                    vy = (Math.random() - 0.5) * 2;
                    dir = -1;
                    console.log('ðŸ¦ Bird flies right â†’ left');
                    break;
                case 3: // Diagonal flight (corner to corner)
                    const fromLeft = Math.random() > 0.5;
                    startX = fromLeft ? -80 : width + 80;
                    startY = height * 0.7 + Math.random() * height * 0.2;
                    vx = fromLeft ? (5 + Math.random() * 3) : -(5 + Math.random() * 3);
                    vy = -(4 + Math.random() * 3);
                    dir = fromLeft ? 1 : -1;
                    console.log('ðŸ¦ Bird flies diagonally â†—');
                    break;
            }
            
            bird = {
                x: startX,
                y: startY,
                direction: dir,
                speedY: vy,
                speedX: vx,
                scale: 0.36 + Math.random() * 0.16,
                wobble: 0,
                frameIndex: 0,
                frameTimer: 0
            };
        }
        
        function updateBird() {
            if (!bird) return;
            
            // Bird moves along its trajectory
            bird.y += bird.speedY;
            bird.x += bird.speedX;
            bird.wobble += 0.08;
            
            // Wing frame animation (change every 5 ticks)
            bird.frameTimer++;
            if (bird.frameTimer >= 5) {
                bird.frameTimer = 0;
                bird.frameIndex = (bird.frameIndex + 1) % 3;
            }
            
            // Bird flew off screen (any direction)
            if (bird.y < -150 || bird.y > height + 150 || 
                bird.x < -150 || bird.x > width + 150) {
                bird = null;
            }
        }
        
        function drawBird() {
            if (!bird || !birdLoaded) return;
            
            // Select current frame
            const currentFrame = birdImages[bird.frameIndex];
            
            // Calculate tilt based on flight angle + wobble
            const flightAngle = Math.atan2(bird.speedY, Math.abs(bird.speedX)) * 0.3;
            const rotation = flightAngle + Math.sin(bird.wobble) * 0.08;
            
            const w = currentFrame.width * bird.scale;
            const h = currentFrame.height * bird.scale;
            
            ctx.save();
            ctx.translate(bird.x, bird.y);
            if (bird.direction < 0) ctx.scale(-1, 1); // Mirror if flying left
            ctx.rotate(rotation);
            ctx.drawImage(currentFrame, -w / 2, -h / 2, w, h);
            ctx.restore();
        }
        
        function loadGrassImages() {
            const imageNames = [
                'Background/green/green1.png',
                'Background/green/green2.png',
                'Background/green/green3.png',
                'Background/green/green4.png',
                'Background/green/green5.png',
                'Background/green/green6.png',
                'Background/green/green7.png',
                'Background/green/green8.png'
            ];
            
            let loadedCount = 0;
            
            imageNames.forEach((name, index) => {
                const img = new Image();
                img.onload = () => {
                    loadedCount++;
                    console.log(`ðŸŒ¿ Loaded image ${index + 1}/8: ${name}`);
                    if (loadedCount === imageNames.length) {
                        grassImagesLoaded = true;
                        console.log('ðŸŒ¿ All grass images loaded!');
                        initGrass(); // Initialize grass after loading
                    }
                };
                img.onerror = () => {
                    console.error(`âŒ Loading error: ${name}`);
                };
                img.src = name;
                grassImages.push(img);
            });
        }
        
        // Grass blade class with PNG image
        class GrassBlade {
            constructor(x, y, layer) {
                this.x = x;
                this.baseY = y;
                this.layer = layer;
                
                // Select random image
                this.imageIndex = Math.floor(Math.random() * 8);
                
                // Random scale (smaller for far layers, larger overall)
                const baseScale = 0.4 + Math.random() * 0.6; // 0.4 - 1.0
                this.scale = baseScale * (0.5 + layer * 0.25); // far ones smaller
                
                // Random mirroring
                this.flipX = Math.random() > 0.5 ? -1 : 1;
                
                // Swaying parameters (reduced for smoothness)
                this.bendAmount = 0;
                this.targetBend = 0;
                this.windPhase = Math.random() * Math.PI * 2;
                this.windSpeed = 0.15 + Math.random() * 0.2; // Slower
                
                // Transparency by layers
                this.alpha = 0.7 + layer * 0.1;
            }

            update() {
                // Base swaying â€” VERY slight, almost imperceptible
                const baseWind = Math.sin(windTime * this.windSpeed + this.windPhase) * 0.015;
                
                // Wind gust â€” wave passes across the field
                let gustForce = 0;
                const distFromGust = Math.abs(this.x - windGustX);
                if (distFromGust < 250) {
                    // Gust strength depends on distance to the "wave"
                    const gustStrength = 1 - distFromGust / 250;
                    gustForce = windGust * gustStrength * windGustDirection;
                }
                
                // Touch reaction
                let touchForce = 0;
                if (touchPos) {
                    const img = grassImages[this.imageIndex];
                    const h = img.height * this.scale;
                    const dx = this.x - touchPos.x;
                    const dy = (this.baseY - h * 0.5) - touchPos.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    const touchRadius = 150;
                    if (dist < touchRadius) {
                        const force = (1 - dist / touchRadius);
                        touchForce = Math.sign(dx) * force * 0.15;
                    }
                }
                
                this.targetBend = baseWind + gustForce + touchForce;
                this.bendAmount += (this.targetBend - this.bendAmount) * 0.06; // Very smooth
            }

            draw() {
                const img = grassImages[this.imageIndex];
                if (!img || !img.complete) return;
                
                const w = img.width * this.scale;
                const h = img.height * this.scale;
                
                ctx.save();
                ctx.globalAlpha = this.alpha;
                
                // Position from bottom point of grass blade
                ctx.translate(this.x, this.baseY);
                
                // Apply tilt (skewX) for swaying
                ctx.transform(1, 0, this.bendAmount, 1, 0, 0);
                
                // Mirroring
                ctx.scale(this.flipX, 1);
                
                // Draw image (center X, bottom to top)
                ctx.drawImage(img, -w / 2, -h, w, h);
                
                ctx.restore();
            }
        }

        function initGrass() {
            if (!grassImagesLoaded) {
                console.log('â³ Waiting for grass images to load...');
                return;
            }
            
            grass = [];
            // Grass density - LOTS of blades for dense field
            const density = width * height / 1800; // Even denser!
            
            for (let layer = 0; layer < 3; layer++) {
                const layerDensity = density / (layer + 1);
                
                for (let i = 0; i < layerDensity; i++) {
                    const x = Math.random() * (width + 100) - 50;
                    // Grass blades cover more of the screen
                    const y = height * 0.25 + Math.random() * height * 0.75;
                    grass.push(new GrassBlade(x, y, layer));
                }
            }
            
            // Additional grass layer at BOTTOM to cover gaps
            const bottomDensity = width / 8; // LOTS of grass at bottom
            for (let i = 0; i < bottomDensity; i++) {
                const x = Math.random() * (width + 100) - 50;
                // Grass blades from 85% of screen to BELOW screen
                const y = height * 0.85 + Math.random() * height * 0.25; // Up to 110% height
                grass.push(new GrassBlade(x, y, 2)); // Foreground
            }
            
            // ANOTHER layer â€” very bottom of screen, very dense
            const veryBottomDensity = width / 6;
            for (let i = 0; i < veryBottomDensity; i++) {
                const x = Math.random() * (width + 100) - 50;
                const y = height * 0.95 + Math.random() * height * 0.15; // Very bottom
                grass.push(new GrassBlade(x, y, 2));
            }
            
            // Another layer â€” very bottom, very dense
            const edgeDensity = width / 10;
            for (let i = 0; i < edgeDensity; i++) {
                const x = Math.random() * (width + 30) - 15;
                const y = height + Math.random() * 50; // Below bottom edge of screen
                grass.push(new GrassBlade(x, y, 2));
            }
            
            // Sort: far ones (small) first, then near ones (large)
            grass.sort((a, b) => {
                if (a.layer !== b.layer) return a.layer - b.layer;
                return a.baseY - b.baseY;
            });
            
            console.log(`ðŸŒ¿ Created ${grass.length} PNG grass blades`);
        }
        
        // Start loading images
        loadGrassImages();

        // Cache background gradient (soft tones for watercolor grass)
        let bgGradient = null;
        function updateBgGradient() {
            bgGradient = ctx.createLinearGradient(0, 0, 0, height);
            bgGradient.addColorStop(0, '#e8f4e0');    // Light top
            bgGradient.addColorStop(0.3, '#d4e4c8');  // Transition
            bgGradient.addColorStop(0.6, '#c5d9b8');  // Middle
            bgGradient.addColorStop(1, '#b0c8a0');    // Green bottom
        }
        
        function animate() {
            // Clear canvas (make transparent so clouds are visible)
            ctx.clearRect(0, 0, width, height);
            
            // Clouds in BACKGROUND (draw first)
            // Force initialization if clouds not yet created
            if (clouds.length === 0 && cloudsLoaded === 2) {
                initClouds();
            }
            updateClouds();
            drawClouds();
            
            windTime += 0.012; // Slower for more natural movement
            
            // Update wind gusts
            updateWindGust();
            
            // Update flowers (swaying)
            updateFlowers();
            
            // CLOVER drawn FIRST â€” UNDER grass! Visible when parting grass
            for (let i = 0; i < flowers.length; i++) {
                if (flowers[i].type === 'clover') {
                    drawSingleFlower(flowers[i]);
                }
            }
            
            // Collect grass and FLOWERS (bellflowers) for sorting
            const allItems = [];
            
            for (let i = 0; i < grass.length; i++) {
                grass[i].update();
                allItems.push({ type: 'grass', item: grass[i], y: grass[i].baseY });
            }
            
            // Integrate flowers (bellflowers and dandelions) into grass
            for (let i = 0; i < flowers.length; i++) {
                if (flowers[i].type === 'flower' || flowers[i].type === 'dandelion') {
                    allItems.push({ type: 'flower', item: flowers[i], y: flowers[i].y });
                }
            }
            
            // Sort by Y
            allItems.sort((a, b) => a.y - b.y);
            
            // Draw grass and flowers ON TOP of clover
            for (let i = 0; i < allItems.length; i++) {
                if (allItems[i].type === 'grass') {
                    allItems[i].item.draw();
                } else {
                    drawSingleFlower(allItems[i].item);
                }
            }
            
            // Update and draw bird (on top of everything)
            updateBird();
            drawBird();
            
            requestAnimationFrame(animate);
        }

        function handleTouch(e) {
            const rect = canvas.getBoundingClientRect();
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
            
            if (!audioInitialized) {
                initAudio();
            }
            
            // If Saturn sound is playing - stop it and return background sounds
            if (currentAudio && !currentAudio.paused) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                unmuteBackgroundSounds();
                hideAlien(); // Hide alien
                // Change button text back if modal is open
                if (modal.classList.contains('show') && audioButton.style.display !== 'none') {
                    const fact = visualFacts.find(f => f.audioUrl && currentAudio.src.includes(f.audioUrl));
                    if (fact) {
                        audioButton.textContent = fact.audioButtonText || "ðŸ”Š listen";
                    }
                }
            }
            
            if (lastTouchPos) {
                const dx = x - lastTouchPos.x;
                const dy = y - lastTouchPos.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                touchMoveDistance += dist;
                
                // Digital grass sound on movement
                if (dist > 3 && Math.random() > 0.6) {
                    playGrassRustleSound();
                    touchCounter++;
                    
                    // Creatures appear on active touch
                    if (Math.random() > 0.88) {
                        // 30% chance fireflies appear in cluster
                        if (Math.random() > 0.7) {
                            spawnFirefliesCluster(x, y);
                        } else {
                            spawnCreature(x, y);
                        }
                    }
                    
                    // Additional creatures every 10 movements
                    if (touchCounter >= 10 && activePearls.length === 0) {
                        if (Math.random() > 0.6) {
                            spawnFirefliesCluster(x, y);
                        } else {
                            spawnCreature(x, y);
                        }
                        touchCounter = 0;
                    }
                }
                
                // Pearl appears separately from creatures
                if (touchMoveDistance > 80 && activePearls.length === 0) {
                    createPearlAtTouch(x, y);
                    touchMoveDistance = 0;
                }
            }
            
            lastTouchPos = { x, y };
            touchPos = { x, y };
            isTouching = true;
        }

        function handleTouchStart(e) {
            const rect = canvas.getBoundingClientRect();
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
            
            // Start creatures on first touch (even if audio is blocked)
            if (!creaturesStarted) {
                creaturesStarted = true;
                startIdleCreatures();
                console.log('ðŸ› Creatures started on first touch!');
            }
            
            if (!audioInitialized) {
                initAudio();
                console.log('ðŸŽµ Audio initialized!');
            }
            
            // If Saturn sound is playing - stop it and return background sounds
            if (currentAudio && !currentAudio.paused) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                unmuteBackgroundSounds();
                hideAlien(); // Hide alien
                console.log('ðŸª Saturn sound stopped (started moving grass)');
                // Change button text back if modal is open
                if (modal.classList.contains('show') && audioButton.style.display !== 'none') {
                    const fact = visualFacts.find(f => f.audioUrl && currentAudio.src.includes(f.audioUrl));
                    if (fact) {
                        audioButton.textContent = fact.audioButtonText || "ðŸ”Š listen";
                    }
                }
            }
            
            lastTouchPos = { x, y };
            touchPos = { x, y };
            touchMoveDistance = 0;
            touchStartTime = Date.now();
            isTouching = true;
        }

        function handleTouchEnd() {
            touchPos = null;
            lastTouchPos = null;
            touchMoveDistance = 0;
            isTouching = false;
        }

        // Create multiple fireflies scattering over a large area
        function spawnFirefliesCluster(centerX, centerY) {
            const count = 2 + Math.floor(Math.random() * 2); // 2-3 fireflies (was 3-5)
            const radius = 150 + Math.random() * 100; // radius 150-250px
            
            // Sound plays once for the entire cluster
            playFireflySound();
            
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    // Random point in circle around touch
                    const angle = Math.random() * Math.PI * 2;
                    const distance = Math.random() * radius;
                    const x = centerX + Math.cos(angle) * distance;
                    const y = centerY + Math.sin(angle) * distance;
                    
                    // Random color for each firefly!
                    const colors = ['red', 'cyan', 'blue', 'small-blue'];
                    const randomColor = colors[Math.floor(Math.random() * colors.length)];
                    
                    // Create firefly WITHOUT sound (pass silent = true) and with color
                    spawnCreature(x, y, 'firefly', true, randomColor);
                }, i * (100 + Math.random() * 200)); // delay 100-300ms between each
            }
        }
        
        // Create grass creature
        function spawnCreature(x, y, forceType = null, silent = false, fireflyColor = null) {
            // Don't spawn creatures in space mode
            if (isSpaceMode) {
                console.log("ðŸš€ Space mode - creatures don't appear");
                return;
            }
            
            const types = [
                { emoji: 'ðŸ¦‹', class: 'butterfly', sound: playButterflySound },
                { emoji: 'âœ¨', class: 'firefly', sound: playFireflySound },
                { emoji: 'ðŸ¦—', class: 'grasshopper', sound: playGrasshopperSound },
                { emoji: 'ðŸž', class: 'ladybug', sound: null }
            ];
            
            // For random selection, exclude ladybug (it has its own timer)
            const randomTypes = types.filter(t => t.class !== 'ladybug');
            const type = forceType ? types.find(t => t.class === forceType) : randomTypes[Math.floor(Math.random() * randomTypes.length)];
            
            const creature = document.createElement('div');
            creature.className = `creature ${type.class}`;
            
            // If firefly AND color specified - add color class
            if (type.class === 'firefly' && fireflyColor) {
                creature.className += ` firefly-${fireflyColor}`;
            }
            
            // For butterfly create nested structure (outer container flies, inner flaps wings)
            if (type.class === 'butterfly') {
                const wings = document.createElement('div');
                wings.className = 'butterfly-wings';
                creature.appendChild(wings);
            }
            
            // For grasshopper and fireflies use images (not emoji)
            if (type.class !== 'butterfly' && type.class !== 'grasshopper' && type.class !== 'firefly') {
                creature.textContent = type.emoji;
            }
            
            creature.style.left = x + 'px';
            creature.style.top = y + 'px';
            
            // Random movement direction with more variability
            if (type.class === 'firefly') {
                // Fireflies fly in different directions more unpredictably
                const dx = (Math.random() - 0.5) * 400; // more spread on X
                const dy = -(Math.random() * 250 + 80); // different lift heights
                const duration = 3 + Math.random() * 3; // from 3 to 6 seconds
                creature.style.setProperty('--dx', dx + 'px');
                creature.style.setProperty('--dy', dy + 'px');
                creature.style.setProperty('--duration', duration + 's');
            } else if (type.class === 'grasshopper') {
                // Grasshoppers jump in different directions
                const dx = (Math.random() - 0.5) * 300;
                const dy = Math.random() * 80 + 100;
                creature.style.setProperty('--dx', dx + 'px');
                creature.style.setProperty('--dy', dy + 'px');
                
                // If jumping left (dx < 0), mirror!
                creature.style.setProperty('--flip', dx < 0 ? -1 : 1);
            } else if (type.class === 'ladybug') {
                // Ladybug - crawls on grass blade (use spawnLadybug instead)
                if (activeLadybug && document.body.contains(activeLadybug)) {
                    creature.remove();
                    return; // Don't spawn duplicate
                }
                creature.style.zIndex = '60';
                activeLadybug = creature;
            } else {
                // Butterflies - fly far across the entire screen!
                const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
                const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
                
                // Flies in random direction across 60-90% of screen width
                const dx = (Math.random() > 0.5 ? 1 : -1) * (vw * 0.6 + Math.random() * vw * 0.3);
                // High up or low to grass
                const dy = Math.random() > 0.5 ? -(vh * 0.4 + Math.random() * vh * 0.3) : (vh * 0.2 + Math.random() * vh * 0.3);
                
                creature.style.setProperty('--dx', dx + 'px');
                creature.style.setProperty('--dy', dy + 'px');
            }
            
            document.body.appendChild(creature);
            
            // Ð—Ð²ÑƒÐº Ð¿Ñ€Ð¾Ð¸Ð³Ñ€Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ Ð½Ðµ silent Ð¸ Ð·Ð²ÑƒÐº ÐµÑÑ‚ÑŒ
            if (!silent && type.sound) {
                type.sound();
            }
            
            // Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð¿Ð¾ÑÐ»Ðµ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸ (Ñ€Ð°Ð·Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð»Ñ Ñ€Ð°Ð·Ð½Ñ‹Ñ… ÑÑƒÑ‰ÐµÑÑ‚Ð²)
            let duration = 3500; // Ð±Ð°Ð±Ð¾Ñ‡ÐºÐ¸ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ
            if (type.class === 'grasshopper') duration = 800;
            else if (type.class === 'firefly') duration = 6000;
            else if (type.class === 'ladybug') duration = 8000;
            
            setTimeout(() => {
                creature.remove();
                if (type.class === 'ladybug') activeLadybug = null;
            }, duration);
        }

        // ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ ÐºÑ€Ð¾Ð»Ð¸ÐºÐ°
        function spawnRabbit() {
            console.log('ðŸ° ===== spawnRabbit Ð²Ñ‹Ð·Ð²Ð°Ð½Ð°! =====');
            
            // ÐÐµ ÑÐ¿Ð°Ð²Ð½Ð¸Ð¼ ÐºÑ€Ð¾Ð»Ð¸ÐºÐ° Ð² ÐºÐ¾ÑÐ¼Ð¸Ñ‡ÐµÑÐºÐ¾Ð¼ Ñ€ÐµÐ¶Ð¸Ð¼Ðµ
            if (isSpaceMode) {
                console.log('ðŸ° âŒ ÐšÑ€Ð¾Ð»Ð¸Ðº Ð½Ðµ Ð¿Ð¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ - Ð°ÐºÑ‚Ð¸Ð²ÐµÐ½ ÐºÐ¾ÑÐ¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼!');
                return;
            }
            
            // Ð¡Ð»ÑƒÑ‡Ð°Ð¹Ð½Ð¾ Ð²Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Ð¿Ð¾ÑÐ²Ð»ÐµÐ½Ð¸Ñ ÐºÑ€Ð¾Ð»Ð¸ÐºÐ° (Ñ€Ð°Ð·Ð½Ð°Ñ Ð²Ñ‹ÑÐ¾Ñ‚Ð° Ð¿Ð¾Ð´ÑŠÑ‘Ð¼Ð°)
            const peekVariants = [
                { height: 40, name: 'Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð²ÐµÑ€Ñ… ÑƒÑˆÐµÐ¹' },      // 1. Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð²ÐµÑ€Ñ… ÑƒÑˆÐµÐ¹
                { height: 80, name: 'ÑƒÑˆÐ¸ Ñ†ÐµÐ»Ð¸ÐºÐ¾Ð¼' },          // 2. Ð£ÑˆÐ¸ Ñ†ÐµÐ»Ð¸ÐºÐ¾Ð¼
                { height: 120, name: 'ÑƒÑˆÐ¸ Ð¸ Ð³Ð»Ð°Ð·Ð°' },         // 3. Ð£ÑˆÐ¸ Ð¸ Ð³Ð»Ð°Ð·Ð°
                { height: 180, name: 'Ð²ÑÑ Ð¼Ð¾Ñ€Ð´Ð°' },           // 4. Ð’ÑÑ Ð¼Ð¾Ñ€Ð´Ð° Ñ†ÐµÐ»Ð¸ÐºÐ¾Ð¼
                { height: 250, name: 'ÐºÑ€Ð¾Ð»Ð¸Ðº Ñ†ÐµÐ»Ð¸ÐºÐ¾Ð¼' }      // 5. ÐšÑ€Ð¾Ð»Ð¸Ðº Ñ†ÐµÐ»Ð¸ÐºÐ¾Ð¼
            ];
            
            const variant = peekVariants[Math.floor(Math.random() * peekVariants.length)];
            console.log(`ðŸ° Ð’Ñ‹Ð±Ñ€Ð°Ð½ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚: ${variant.name} (Ð²Ñ‹ÑÐ¾Ñ‚Ð°: ${variant.height}px)`);
            
            const rabbit = document.createElement('div');
            rabbit.className = 'creature rabbit';
            
            // Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ CSS Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ð´Ð»Ñ Ð²Ñ‹ÑÐ¾Ñ‚Ñ‹ Ð¿Ð¾Ð´ÑŠÑ‘Ð¼Ð°
            rabbit.style.setProperty('--rabbit-peek-height', variant.height + 'px');
            
            // Ð’Ð¡Ð•Ð“Ð”Ð Ð¿Ð¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ ÑÑ‚Ñ€Ð¾Ð³Ð¾ ÑÐ½Ð¸Ð·Ñƒ ÑÐºÑ€Ð°Ð½Ð°, Ð¿Ð¾ Ñ†ÐµÐ½Ñ‚Ñ€Ñƒ Ð¸Ð»Ð¸ Ñ‡ÑƒÑ‚ÑŒ Ð»ÐµÐ²ÐµÐµ/Ð¿Ñ€Ð°Ð²ÐµÐµ
            const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
            const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
            
            // Ð¡Ð»ÑƒÑ‡Ð°Ð¹Ð½Ð°Ñ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ Ð¿Ð¾ Ð³Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð°Ð»Ð¸ (Ð½Ð¾ Ð½Ðµ ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ñƒ ÐºÑ€Ð°Ñ‘Ð²)
            const x = vw * 0.2 + Math.random() * (vw * 0.6); // Ð¾Ñ‚ 20% Ð´Ð¾ 80% ÑˆÐ¸Ñ€Ð¸Ð½Ñ‹ ÑÐºÑ€Ð°Ð½Ð°
            const y = vh - 40; // ÐŸÑ€Ð¸Ð¶Ð°Ñ‚ Ðº ÑÐ°Ð¼Ð¾Ð¼Ñƒ Ð½Ð¸Ð·Ñƒ (Ñ Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÐ¸Ð¼ Ð¾Ñ‚ÑÑ‚ÑƒÐ¿Ð¾Ð¼)
            
            console.log(`ðŸ° ÐŸÐ¾Ð·Ð¸Ñ†Ð¸Ñ: x=${Math.round(x)}, y=${Math.round(y)}, vw=${vw}, vh=${vh}`);
            
            rabbit.style.left = x + 'px';
            rabbit.style.top = y + 'px';
            
            document.body.appendChild(rabbit);
            console.log(`ðŸ° âœ… ÐšÑ€Ð¾Ð»Ð¸Ðº Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ! Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚: ${variant.name}`);
            
            // Ð—Ð²ÑƒÐº ÐºÑ€Ð¾Ð»Ð¸ÐºÐ°
            if (audioContext && Math.random() > 0.4) {
                playGrassRustleSound(); // ÑˆÐ¾Ñ€Ð¾Ñ… Ñ‚Ñ€Ð°Ð²Ñ‹ Ð¾Ñ‚ ÐºÑ€Ð¾Ð»Ð¸ÐºÐ°
            }
            
            setTimeout(() => rabbit.remove(), 3000); // 3 ÑÐµÐºÑƒÐ½Ð´Ñ‹ Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÑÐ¿ÐµÑ‚ÑŒ Ñ€Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ
        }

        // ÐšÑƒÐ·Ð½ÐµÑ‡Ð¸ÐºÐ¸ Ð¿Ñ€Ñ‹Ð³Ð°ÑŽÑ‚ Ð¸Ð·Ñ€ÐµÐ´ÐºÐ° Ð² Ð¿Ð¾ÐºÐ¾Ðµ
        function startIdleCreatures() {
            // ÐšÑƒÐ·Ð½ÐµÑ‡Ð¸ÐºÐ¸ Ð¿Ð¾ÑÐ²Ð»ÑÑŽÑ‚ÑÑ
            setInterval(() => {
                // Don't spawn in space mode
                if (isSpaceMode) return;
                
                if (!isTouching && Math.random() > 0.5) {
                    const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
                    const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
                    const x = Math.random() * vw;
                    const y = vh * 0.6 + Math.random() * vh * 0.4; // Ð¿Ð¾ÑÐ²Ð»ÑÑŽÑ‚ÑÑ Ð²Ð½Ð¸Ð·Ñƒ ÑÐºÑ€Ð°Ð½Ð°
                    spawnCreature(x, y, 'grasshopper');
                }
            }, 6000); // ÐºÐ°Ð¶Ð´Ñ‹Ðµ 6 ÑÐµÐºÑƒÐ½Ð´
            
            // Ð‘Ð¾Ð¶ÑŒÑ ÐºÐ¾Ñ€Ð¾Ð²ÐºÐ° â€” Ð² 3 Ñ€Ð°Ð·Ð° Ñ€ÐµÐ¶Ðµ Ñ‡ÐµÐ¼ ÐºÑƒÐ·Ð½ÐµÑ‡Ð¸ÐºÐ¸
            setInterval(() => {
                // Don't spawn in space mode
                if (isSpaceMode) return;
                
                if (!isTouching && Math.random() > 0.6) {
                    spawnLadybug();
                }
            }, 18000); // ÐºÐ°Ð¶Ð´Ñ‹Ðµ 18 ÑÐµÐºÑƒÐ½Ð´ (Ð² 3 Ñ€Ð°Ð·Ð° Ñ€ÐµÐ¶Ðµ)
            
            // ÐšÑ€Ð¾Ð»Ð¸Ðº Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ð¿Ð¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ÑÐ»Ðµ 3-Ð¹ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ (Ð½Ðµ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸)
        }
        
        // Ð‘Ð¾Ð¶ÑŒÑ ÐºÐ¾Ñ€Ð¾Ð²ÐºÐ° Ð²Ñ‹Ð¿Ð¾Ð»Ð·Ð°ÐµÑ‚ Ð½Ð° Ð»Ð¸ÑÑ‚Ð¸Ðº
        let activeLadybug = null; // Only one ladybug at a time!
        
        function spawnLadybug() {
            if (isSpaceMode) return;
            
            // Don't spawn if one already exists
            if (activeLadybug && document.body.contains(activeLadybug)) {
                console.log('ðŸž Ladybug already on screen, skipping');
                return;
            }
            
            const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
            const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
            
            const ladybug = document.createElement('div');
            ladybug.className = 'creature ladybug';
            
            // ÐŸÐ¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ð²Ð½Ð¸Ð·Ñƒ ÑÐºÑ€Ð°Ð½Ð°, Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ Ñ‚Ñ€Ð°Ð²Ñ‹
            const x = vw * 0.15 + Math.random() * vw * 0.7;
            const y = vh * 0.5 + Math.random() * vh * 0.35;
            
            ladybug.style.left = x + 'px';
            ladybug.style.top = y + 'px';
            ladybug.style.zIndex = '60';
            
            document.body.appendChild(ladybug);
            activeLadybug = ladybug;
            console.log('ðŸž Ð‘Ð¾Ð¶ÑŒÑ ÐºÐ¾Ñ€Ð¾Ð²ÐºÐ° Ð²Ñ‹Ð¿Ð¾Ð»Ð·Ð»Ð°!');
            
            // Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð¿Ð¾ÑÐ»Ðµ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸ (8 ÑÐµÐºÑƒÐ½Ð´)
            setTimeout(() => {
                ladybug.remove();
                activeLadybug = null;
            }, 8000);
        }
        
        // ÐšÑ€Ð¾Ð»Ð¸Ðº Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑŒÑÑ Ð¿Ñ€Ð¸ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾Ð¼ ÐºÐ°ÑÐ°Ð½Ð¸Ð¸ Ñ‚Ñ€Ð°Ð²Ñ‹
        function maybeSpawnRabbitOnTouch(x, y) {
            // 15% ÑˆÐ°Ð½Ñ Ñ‡Ñ‚Ð¾ Ñ€Ð°Ð·Ð´Ð²Ð¸Ð½ÐµÑˆÑŒ Ñ‚Ñ€Ð°Ð²Ñƒ Ð¸ ÑƒÐ²Ð¸Ð´Ð¸ÑˆÑŒ Ñ‡Ð°ÑÑ‚ÑŒ ÐºÑ€Ð¾Ð»Ð¸ÐºÐ°
            if (Math.random() > 0.85 && activePearls.length === 0) {
                spawnRabbit();
            }
        }

        function createPearlAtTouch(x, y) {
            console.log('ðŸ’Ž createPearlAtTouch Ð²Ñ‹Ð·Ð²Ð°Ð½Ð°! x:', x, 'y:', y);
            const pearl = document.createElement('div');
            pearl.className = 'pearl';
            
            const offsetX = (Math.random() - 0.5) * 100;
            const offsetY = (Math.random() - 0.5) * 50;
            
            // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¶ÐµÐ¼Ñ‡ÑƒÐ¶Ð¸Ð½Ð° Ð½Ðµ Ð²Ñ‹Ñ…Ð¾Ð´Ð¸Ð»Ð° Ð·Ð° ÐºÑ€Ð°Ñ ÑÐºÑ€Ð°Ð½Ð°
            let pearlX = x + offsetX;
            let pearlY = y + offsetY;
            
            const margin = 50; // Ð¾Ñ‚ÑÑ‚ÑƒÐ¿ Ð¾Ñ‚ ÐºÑ€Ð°Ñ‘Ð²
            pearlX = Math.max(margin, Math.min(pearlX, window.innerWidth - margin));
            pearlY = Math.max(margin, Math.min(pearlY, window.innerHeight - margin));
            
            pearl.style.left = pearlX + 'px';
            pearl.style.top = pearlY + 'px';
            
            // ÐšÐ¾ÑÐ¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð·Ð²ÑƒÐº Ð¿Ð¾ÑÐ²Ð»ÐµÐ½Ð¸Ñ Ð¶ÐµÐ¼Ñ‡ÑƒÐ¶Ð¸Ð½Ñ‹
            playPearlAppearSound();
            
            pearl.addEventListener('click', (e) => {
                e.stopPropagation();
                console.log('ðŸ’Ž Ð–ÐµÐ¼Ñ‡ÑƒÐ¶Ð¸Ð½Ð° ÐºÐ»Ð¸ÐºÐ½ÑƒÑ‚Ð°! Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ ÑÑ‡Ñ‘Ñ‚Ñ‡Ð¸Ðº ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐµÐº:', cardsShownCount);
                
                // 70% ÑˆÐ°Ð½Ñ ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÐ° Ñ Ñ„Ð°ÐºÑ‚Ð¾Ð¼, 30% ÑˆÐ°Ð½Ñ Ñ‚ÐµÐºÑÑ‚
                const isVisualCard = Math.random() > 0.3;
                
                if (isVisualCard) {
                    // Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½ÑƒÑŽ Ð½ÐµÐ¿Ð¾ÐºÐ°Ð·Ð°Ð½Ð½ÑƒÑŽ Ð²Ð¸Ð·ÑƒÐ°Ð»ÑŒÐ½ÑƒÑŽ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÑƒ
                    let availableFacts = visualFacts.filter(f => !shownVisualFacts.includes(f) && f !== lastShownFact);
                    
                    // Ð•ÑÐ»Ð¸ Ð²ÑÐµ Ð¿Ð¾ÐºÐ°Ð·Ð°Ð½Ñ‹ - ÑÐ±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼
                    if (availableFacts.length === 0) {
                        shownVisualFacts = [];
                        availableFacts = visualFacts.filter(f => f !== lastShownFact);
                        if (availableFacts.length === 0) availableFacts = visualFacts;
                        console.log('ðŸ”„ Ð’ÑÐµ Ð²Ð¸Ð·ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð¿Ð¾ÐºÐ°Ð·Ð°Ð½Ñ‹, Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÐ¼ Ð·Ð°Ð½Ð¾Ð²Ð¾!');
                    }
                    
                    // Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½ÑƒÑŽ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÑƒ
                    const randomIndex = Math.floor(Math.random() * availableFacts.length);
                    const selectedFact = availableFacts[randomIndex];
                    const factIndex = visualFacts.indexOf(selectedFact);
                    shownVisualFacts.push(selectedFact);
                    lastShownFact = selectedFact;
                    
                    console.log(`ðŸŽ´ Ð’Ð¸Ð·ÑƒÐ°Ð»ÑŒÐ½Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ°: "${selectedFact.fact?.substring(0, 40)}" (Ð¿Ð¾ÐºÐ°Ð·Ð°Ð½Ð¾ ${shownVisualFacts.length}/${visualFacts.length})`);
                    showVisualFact(factIndex);
                } else {
                    // Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½ÑƒÑŽ Ð½ÐµÐ¿Ð¾ÐºÐ°Ð·Ð°Ð½Ð½ÑƒÑŽ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²ÑƒÑŽ Ð¼ÑƒÐ´Ñ€Ð¾ÑÑ‚ÑŒ
                    let availableWisdoms = wisdoms.filter(w => !shownWisdoms.includes(w) && w !== lastShownWisdom);
                    
                    // Ð•ÑÐ»Ð¸ Ð²ÑÐµ Ð¿Ð¾ÐºÐ°Ð·Ð°Ð½Ñ‹ - ÑÐ±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼
                    if (availableWisdoms.length === 0) {
                        shownWisdoms = [];
                        availableWisdoms = wisdoms.filter(w => w !== lastShownWisdom);
                        if (availableWisdoms.length === 0) availableWisdoms = wisdoms;
                        console.log('ðŸ”„ Ð’ÑÐµ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð¼ÑƒÐ´Ñ€Ð¾ÑÑ‚Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ð°Ð½Ñ‹, Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÐ¼ Ð·Ð°Ð½Ð¾Ð²Ð¾!');
                    }
                    
                    // Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½ÑƒÑŽ Ð¼ÑƒÐ´Ñ€Ð¾ÑÑ‚ÑŒ
                    const randomIndex = Math.floor(Math.random() * availableWisdoms.length);
                    const selectedWisdom = availableWisdoms[randomIndex];
                    const wisdomIndex = wisdoms.indexOf(selectedWisdom);
                    shownWisdoms.push(selectedWisdom);
                    lastShownWisdom = selectedWisdom;
                    
                    console.log(`ðŸ“œ Ð¢ÐµÐºÑÑ‚Ð¾Ð²Ð°Ñ Ð¼ÑƒÐ´Ñ€Ð¾ÑÑ‚ÑŒ: "${selectedWisdom?.substring(0, 40)}..." (Ð¿Ð¾ÐºÐ°Ð·Ð°Ð½Ð¾ ${shownWisdoms.length}/${wisdoms.length})`);
                    showWisdom(wisdomIndex);
                }
                
                pearl.remove();
                activePearls = activePearls.filter(p => p !== pearl);
            });
            
            document.body.appendChild(pearl);
            activePearls.push(pearl);
            
            setTimeout(() => {
                if (activePearls.includes(pearl)) {
                    pearl.style.transition = 'opacity 0.5s ease';
                    pearl.style.opacity = '0';
                    setTimeout(() => {
                        pearl.remove();
                        activePearls = activePearls.filter(p => p !== pearl);
                    }, 500);
                }
            }, 10000);
        }
        
        // Throttling Ð´Ð»Ñ Ð¿Ð»Ð°Ð²Ð½Ð¾ÑÑ‚Ð¸
        let lastTouchTime = 0;
        const TOUCH_THROTTLE = 16; // ~60fps
        
        canvas.addEventListener('touchstart', handleTouchStart);
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const now = Date.now();
            if (now - lastTouchTime >= TOUCH_THROTTLE) {
                lastTouchTime = now;
                handleTouch(e);
            }
        }, { passive: false });
        canvas.addEventListener('touchend', handleTouchEnd);
        
        canvas.addEventListener('mousedown', handleTouchStart);
        canvas.addEventListener('mousemove', (e) => {
            if (e.buttons === 1) {
                const now = Date.now();
                if (now - lastTouchTime >= TOUCH_THROTTLE) {
                    lastTouchTime = now;
                    handleTouch(e);
                }
            }
        });
        canvas.addEventListener('mouseup', handleTouchEnd);
        canvas.addEventListener('mouseleave', handleTouchEnd);

        window.addEventListener('resize', () => {
            width = window.innerWidth;
            height = window.innerHeight;
            
            // ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ canvas Ñ ÑƒÑ‡Ñ‘Ñ‚Ð¾Ð¼ DPI
            canvas.width = width * dpr;
            canvas.height = height * dpr;
            canvas.style.width = width + 'px';
            canvas.style.height = height + 'px';
            ctx.setTransform(1, 0, 0, 1, 0, 0); // Ð¡Ð±Ñ€Ð¾Ñ Ñ‚Ñ€Ð°Ð½ÑÑ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸
            ctx.scale(dpr, dpr);
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            
            updateBgGradient(); // ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ð³Ñ€Ð°Ð´Ð¸ÐµÐ½Ñ‚ Ð¿Ñ€Ð¸ resize
            initGrass();
            if (flowersLoaded) initFlowers(); // ÐŸÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ñ‘Ð¼ Ñ†Ð²ÐµÑ‚Ñ‹
        });

        let modalTouchActive = false;
        let autoCloseTimer = null;

        function showWisdom(index) {
            const content = document.getElementById('pearlContent');
            content.classList.remove('evaporating');
            
            // Ð¡ÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼ ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÑƒ, Ð¿Ð¾Ð´Ð¿Ð¸ÑÑŒ, credit Ð¸ Ð°ÑƒÐ´Ð¸Ð¾ ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð´Ð»Ñ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ñ… ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐµÐº
            pearlImage.style.display = 'none';
            pearlCaption.style.display = 'none';
            pearlImageCredit.style.display = 'none';
            audioButton.style.display = 'none';
            
            pearlText.textContent = wisdoms[index];
            modal.classList.add('show');
            modalTouchActive = false;
            
            // Ð£Ð²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°ÐµÐ¼ ÑÑ‡Ñ‘Ñ‚Ñ‡Ð¸Ðº ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐµÐº Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð½Ð° ÐºÑ€Ð¾Ð»Ð¸ÐºÐ°
            cardsShownCount++;
            console.log('ðŸ“Š ÐšÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ° Ð¿Ð¾ÐºÐ°Ð·Ð°Ð½Ð°! Ð¡Ñ‡Ñ‘Ñ‚Ñ‡Ð¸Ðº:', cardsShownCount);
            if (cardsShownCount === 3) {
                // Ð¡Ð»ÑƒÑ‡Ð°Ð¹Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð¿Ð¾ÑÐ²Ð»ÐµÐ½Ð¸Ñ ÐºÑ€Ð¾Ð»Ð¸ÐºÐ° (Ð¾Ñ‚ 0.5 Ð´Ð¾ 2 ÑÐµÐºÑƒÐ½Ð´)
                const randomDelay = 500 + Math.random() * 1500; // 500-2000ms
                console.log(`ðŸ° âœ… Ð¡Ñ‡Ñ‘Ñ‚Ñ‡Ð¸Ðº Ð´Ð¾ÑÑ‚Ð¸Ð³ 3! Ð’Ñ‹Ð·Ñ‹Ð²Ð°ÐµÐ¼ ÐºÑ€Ð¾Ð»Ð¸ÐºÐ° Ñ‡ÐµÑ€ÐµÐ· ${Math.round(randomDelay)}ms...`);
                // ÐŸÐ¾ÑÐ»Ðµ 3-Ð¹ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ ÐºÑ€Ð¾Ð»Ð¸ÐºÐ°!
                setTimeout(() => {
                    console.log('ðŸ° â° Ð¢Ð°Ð¹Ð¼ÐµÑ€ ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°Ð»! Ð’Ñ‹Ð·Ñ‹Ð²Ð°ÐµÐ¼ spawnRabbit()...');
                    spawnRabbit();
                }, randomDelay); // ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð¿Ð¾ÑÐ»Ðµ Ð¿Ð¾ÐºÐ°Ð·Ð° ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸
            }
            
            // Ð’Ñ€ÐµÐ¼Ñ Ð¿Ð¾ÐºÐ°Ð·Ð° Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ Ð´Ð»Ð¸Ð½Ñ‹ Ñ‚ÐµÐºÑÑ‚Ð° (Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð½Ð¾ 60Ð¼Ñ Ð½Ð° ÑÐ¸Ð¼Ð²Ð¾Ð», Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ 3 ÑÐµÐº)
            const textLength = wisdoms[index].length;
            const readingTime = Math.max(3000, textLength * 60);
            
            clearTimeout(autoCloseTimer);
            autoCloseTimer = setTimeout(() => {
                if (!modalTouchActive) {
                    closeModal();
                }
            }, readingTime);
        }

        // Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð´Ð»Ñ Ð¸Ð½Ð¾Ð¿Ð»Ð°Ð½ÐµÑ‚ÑÐ½Ð¸Ð½Ð° - Ð¿Ð»Ð°Ð²Ð½Ð¾Ðµ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ ÐºÐ°Ðº Ð±Ð¸Ð»ÑŒÑÑ€Ð´Ð½Ñ‹Ð¹ ÑˆÐ°Ñ€
        function showAlien() {
            if (!alienElement) {
                alienElement = document.createElement('div');
                alienElement.className = 'alien';
                
                const alienSize = 250;
                // ÐšÑÑˆÐ¸Ñ€ÑƒÐµÐ¼ Ñ€Ð°Ð·Ð¼ÐµÑ€Ñ‹ Ð¾ÐºÐ½Ð° (Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÑŽÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¸ resize)
                let maxX = window.innerWidth - alienSize;
                let maxY = window.innerHeight - alienSize;
                
                // Ð¡Ð»ÑƒÑˆÐ°ÐµÐ¼ resize Ð´Ð»Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð³Ñ€Ð°Ð½Ð¸Ñ†
                alienResizeHandler = () => {
                    maxX = window.innerWidth - alienSize;
                    maxY = window.innerHeight - alienSize;
                };
                window.addEventListener('resize', alienResizeHandler);
                
                // ÐÐ°Ñ‡Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ - ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ð°Ñ Ñ‚Ð¾Ñ‡ÐºÐ° Ð½Ð° ÑÐºÑ€Ð°Ð½Ðµ
                let x = Math.random() * maxX;
                let y = Math.random() * maxY;
                
                // Ð¡ÐºÐ¾Ñ€Ð¾ÑÑ‚ÑŒ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ñ - ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ð¾Ðµ Ð½Ð°Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ (Ñ‡ÑƒÑ‚ÑŒ Ð¼ÐµÐ´Ð»ÐµÐ½Ð½ÐµÐµ Ð´Ð»Ñ Ð¿Ð»Ð°Ð²Ð½Ð¾ÑÑ‚Ð¸)
                const speed = 0.7 + Math.random() * 0.8; // 0.7-1.5 Ð¿Ð¸ÐºÑÐµÐ»Ñ Ð·Ð° ÐºÐ°Ð´Ñ€ (Ð¼ÐµÐ´Ð»ÐµÐ½Ð½ÐµÐµ)
                let angle = Math.random() * Math.PI * 2;
                let vx = Math.cos(angle) * speed;
                let vy = Math.sin(angle) * speed;
                
                // ÐŸÐ¾ÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ðµ
                let wobbleAngle = 0;
                
                document.body.appendChild(alienElement);
                
                // ÐŸÐ»Ð°Ð²Ð½Ð¾Ðµ Ð¿Ð¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ
                requestAnimationFrame(() => {
                    if (alienElement) alienElement.style.opacity = '1';
                });
                
                console.log('ðŸ‘½ Ð˜Ð½Ð¾Ð¿Ð»Ð°Ð½ÐµÑ‚ÑÐ½Ð¸Ð½ Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ ÑÐ²Ð¾Ð±Ð¾Ð´Ð½Ñ‹Ð¹ Ð¿Ð¾Ð»Ñ‘Ñ‚ Ð¿Ð¾ ÑÐºÑ€Ð°Ð½Ñƒ!');
                
                // ÐÐ½Ð¸Ð¼Ð°Ñ†Ð¸Ñ Ð±Ð¸Ð»ÑŒÑÑ€Ð´Ð½Ð¾Ð³Ð¾ ÑˆÐ°Ñ€Ð° (Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ)
                function animateAlien() {
                    if (!alienElement) {
                        return;
                    }
                    
                    // Ð”Ð²Ð¸Ð³Ð°ÐµÐ¼ Ð¸Ð½Ð¾Ð¿Ð»Ð°Ð½ÐµÑ‚ÑÐ½Ð¸Ð½Ð°
                    x += vx;
                    y += vy;
                    
                    // ÐžÑ‚ÑÐºÐ¾Ðº Ð¾Ñ‚ ÐºÑ€Ð°Ñ‘Ð²
                    if (x <= 0) { x = 0; vx = Math.abs(vx); }
                    else if (x >= maxX) { x = maxX; vx = -Math.abs(vx); }
                    
                    if (y <= 0) { y = 0; vy = Math.abs(vy); }
                    else if (y >= maxY) { y = maxY; vy = -Math.abs(vy); }
                    
                    // ÐŸÐ¾ÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ðµ
                    wobbleAngle += 0.04;
                    const wobble = Math.sin(wobbleAngle) * 2;
                    
                    // GPU-ÑƒÑÐºÐ¾Ñ€ÐµÐ½Ð½Ñ‹Ð¹ transform (translate3d)
                    alienElement.style.transform = `translate3d(${x}px, ${y + wobble}px, 0)`;
                    
                    alienAnimationId = requestAnimationFrame(animateAlien);
                }
                
                alienAnimationId = requestAnimationFrame(animateAlien);
            }
        }

        function hideAlien() {
            if (alienAnimationId) {
                cancelAnimationFrame(alienAnimationId);
                alienAnimationId = null;
            }
            if (alienResizeHandler) {
                window.removeEventListener('resize', alienResizeHandler);
                alienResizeHandler = null;
            }
            if (alienElement) {
                alienElement.style.opacity = '0';
                setTimeout(() => {
                    if (alienElement) {
                        alienElement.remove();
                        alienElement = null;
                    }
                }, 500);
                console.log('ðŸ‘½ Ð˜Ð½Ð¾Ð¿Ð»Ð°Ð½ÐµÑ‚ÑÐ½Ð¸Ð½ Ð¸ÑÑ‡ÐµÐ·!');
            }
        }
        
        // Ð¡ÐºÑ€Ñ‹Ñ‚ÑŒ Ð²ÑÐµÑ… Ð¶Ð¸Ñ‚ÐµÐ»ÐµÐ¹ Ñ‚Ñ€Ð°Ð²Ñ‹ (Ð´Ð»Ñ ÐºÐ¾ÑÐ¼Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ñ€ÐµÐ¶Ð¸Ð¼Ð°)
        function hideAllCreatures() {
            document.querySelectorAll('.creature').forEach(creature => {
                creature.style.opacity = '0';
                setTimeout(() => creature.remove(), 300);
            });
            console.log('ðŸŒ¿ Ð’ÑÐµ Ð¶Ð¸Ñ‚ÐµÐ»Ð¸ Ñ‚Ñ€Ð°Ð²Ñ‹ ÑÐºÑ€Ñ‹Ñ‚Ñ‹ Ð´Ð»Ñ ÐºÐ¾ÑÐ¼Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ ÑÑŽÐ¶ÐµÑ‚Ð°');
        }

        const saturnImgEl = document.getElementById('saturnImage');
        const saturnImgSrc = new URL('Background/hubble-saturn-visible-light.jpg', window.location.href).href;
        let saturnLoaded = false;
        
        // ÐŸÑ€ÐµÐ´Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÐ¸ Ð¡Ð°Ñ‚ÑƒÑ€Ð½Ð°
        const saturnPreload = new Image();
        saturnPreload.onload = () => { saturnLoaded = true; console.log('ðŸª ÐšÐ°Ñ€Ñ‚Ð¸Ð½ÐºÐ° Ð¡Ð°Ñ‚ÑƒÑ€Ð½Ð° Ð¿Ñ€ÐµÐ´Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð°'); };
        saturnPreload.src = saturnImgSrc;

        // Ð£Ð½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ/Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ ÐºÐ¾ÑÐ¼Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ñ€ÐµÐ¶Ð¸Ð¼Ð°
        function enterSaturnMode() {
            if (isSpaceMode) return; // Ð£Ð¶Ðµ Ð² ÐºÐ¾ÑÐ¼Ð¾ÑÐµ
            isSpaceMode = true; // Ð¡Ñ‚Ð°Ð²Ð¸Ð¼ Ñ„Ð»Ð°Ð³ Ð¡Ð ÐÐ—Ð£
            
            console.log('ðŸª Ð’Ñ…Ð¾Ð´Ð¸Ð¼ Ð² ÐºÐ¾ÑÐ¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼!');
            
            // Hide grass and UI, show Saturn
            canvas.style.display = 'none';
            document.getElementById('greenBackground').style.display = 'none';
            document.getElementById('cloudsContainer').style.display = 'none';
            
            // ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ñ‡Ñ‘Ñ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ð½ ÑÑ€Ð°Ð·Ñƒ
            saturnBackground.style.display = 'block';
            saturnBackground.style.opacity = '1';
            
            // ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÑƒ (Ð¾Ð½Ð° ÑƒÐ¶Ðµ Ð¿Ñ€ÐµÐ´Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð° Ð¸Ð»Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑÑ)
            saturnImgEl.src = saturnImgSrc;
            saturnImgEl.style.display = 'block';
            saturnImgEl.style.opacity = '1';

            hideAllCreatures();
            modal.classList.remove('show');
            showAlien();
        }

        function exitSaturnMode() {
            if (!isSpaceMode) return; // Ð£Ð¶Ðµ Ð²Ñ‹ÑˆÐ»Ð¸
            
            console.log('ðŸª Ð’Ñ‹Ñ…Ð¾Ð´Ð¸Ð¼ Ð¸Ð· ÐºÐ¾ÑÐ¼Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ñ€ÐµÐ¶Ð¸Ð¼Ð°!');
            
            // ÐžÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð°ÑƒÐ´Ð¸Ð¾
            if (currentAudio && !currentAudio.paused) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            unmuteBackgroundSounds();
            
            saturnBackground.style.opacity = '0';
            saturnImgEl.style.opacity = '0';
            setTimeout(() => {
                if (!isSpaceMode) { // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÐµÑ‰Ñ‘ Ñ€Ð°Ð·
                    saturnBackground.style.display = 'none';
                    saturnImgEl.style.display = 'none';
                }
            }, 350);
            canvas.style.display = 'block';
            document.getElementById('greenBackground').style.display = 'block';
            document.getElementById('cloudsContainer').style.display = 'block';
            isSpaceMode = false;
            hideAlien();
            // ÐÐ• Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÑƒ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾ - Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ñ‚Ñ€Ð°Ð²Ñƒ
        }

        // Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ»Ð¸ÐºÐ° Ð¿Ð¾ Ñ„Ð¾Ð½Ñƒ Ð¡Ð°Ñ‚ÑƒÑ€Ð½Ð° Ð¸ ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÐµ â€” Ð²Ñ‹Ñ…Ð¾Ð´ Ð¸Ð· ÐºÐ¾ÑÐ¼Ð¾ÑÐ°
        saturnBackground.addEventListener('click', function(e) {
            if (isSpaceMode) {
                exitSaturnMode();
            }
        });
        saturnImgEl.addEventListener('click', function(e) {
            if (isSpaceMode) {
                exitSaturnMode();
            }
        });

        // Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð´Ð»Ñ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ñ„Ð¾Ð½Ð¾Ð²Ñ‹Ð¼Ð¸ Ð·Ð²ÑƒÐºÐ°Ð¼Ð¸
        function muteBackgroundSounds() {
            // ÐŸÐ¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¾ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð²ÐµÑ‚ÐµÑ€
            if (windGainNode && audioContext) {
                windGainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.3);
            }
            // ÐŸÐ¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¾ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ ambient (ÑƒÑ‚ÐºÐ¸) - pause Ð²Ð¼ÐµÑÑ‚Ð¾ volume
            if (ambientAudio) {
                ambientAudio.pause();
            }
        }

        function unmuteBackgroundSounds() {
            // Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ð²ÐµÑ‚ÐµÑ€
            if (windGainNode && audioContext) {
                windGainNode.gain.linearRampToValueAtTime(0.08, audioContext.currentTime + 0.5);
            }
            // Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ ambient (ÑƒÑ‚ÐºÐ¸)
            if (ambientAudio) {
                ambientAudio.volume = 0.20;
                ambientAudio.play().catch(() => {});
            }
        }

        function showVisualFact(index) {
            const content = document.getElementById('pearlContent');
            content.classList.remove('evaporating');
            
            const fact = visualFacts[index];
            
            // Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÑƒ: ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ Ð¼Ð°ÑÑÐ¸Ð² imageUrls - ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½ÑƒÑŽ, Ð¸Ð½Ð°Ñ‡Ðµ imageUrl
            const imageUrl = fact.imageUrls 
                ? fact.imageUrls[Math.floor(Math.random() * fact.imageUrls.length)]
                : fact.imageUrl;
            
            // ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÑƒ Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¾Ð¹ Ð¾ÑˆÐ¸Ð±Ð¾Ðº
            pearlImage.src = imageUrl;
            pearlImage.style.display = 'block';
            
            // Ð•ÑÐ»Ð¸ ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÐ° Ð½Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ð»Ð°ÑÑŒ - ÑÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼ ÐµÑ‘ Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ
            pearlImage.onerror = function() {
                pearlImage.style.display = 'none';
                console.log('âŒ ÐšÐ°Ñ€Ñ‚Ð¸Ð½ÐºÐ° Ð½Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ð»Ð°ÑÑŒ:', imageUrl);
            };
            
            pearlImage.onload = function() {
                console.log('âœ… ÐšÐ°Ñ€Ñ‚Ð¸Ð½ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð°:', imageUrl);
            };
            
            // ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ñ„Ð°ÐºÑ‚
            pearlText.textContent = fact.fact;
            
            // ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð¿Ð¾Ð´Ð¿Ð¸ÑÑŒ ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ
            if (fact.caption) {
                pearlCaption.textContent = fact.caption;
                pearlCaption.style.display = 'block';
            } else {
                pearlCaption.style.display = 'none';
            }
            
            // ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ credit ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ (Ð¼ÐµÐ»ÐºÐ¾ ÑÐ±Ð¾ÐºÑƒ Ð½Ð° ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÐµ)
            if (fact.imageCredit) {
                pearlImageCredit.textContent = fact.imageCredit;
                pearlImageCredit.style.display = 'block';
            } else {
                pearlImageCredit.style.display = 'none';
            }
            
            // ÐŸÑ€Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ðµ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ Ñ‚Ñ€Ð°Ð²Ð° Ð²Ð¸Ð´Ð½Ð° (ÐÐ• Ñ‚Ñ€Ð¾Ð³Ð°ÐµÐ¼ saturnBackground Ð·Ð´ÐµÑÑŒ!)
            // Ð¤Ð¾Ð½ Ð¼ÐµÐ½ÑÐµÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¸ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ¸ "ÑÐ»ÑƒÑˆÐ°Ñ‚ÑŒ Ð·Ð²ÑƒÐº Ð¡Ð°Ñ‚ÑƒÑ€Ð½Ð°"
            if (!isSpaceMode) {
                canvas.style.display = 'block';
            }
            
        // ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð°ÑƒÐ´Ð¸Ð¾ ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ
        if (fact.audioUrl) {
            audioButton.textContent = fact.audioButtonText || "ðŸ”Š listen";
            audioButton.style.display = 'block';
            
            // ÐžÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐµ Ð°ÑƒÐ´Ð¸Ð¾ ÐµÑÐ»Ð¸ Ð±Ñ‹Ð»Ð¾
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            
            // ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ½Ð¾Ð¿ÐºÐ¸
            audioButton.onclick = function(e) {
                e.stopPropagation();
                
                // Saturn card detection
                const isSaturnCard = fact.audioUrl && fact.audioUrl.toLowerCase().includes('casskr');
                
                // Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ¾Ð²: Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ð¸ fallback Ð² Ð¿Ð°Ð¿ÐºÐµ saturn
                const filename = fact.audioUrl.split('/').pop();
                const sources = [
                    new URL(fact.audioUrl, window.location.href).href,
                    new URL(`saturn/${filename}`, window.location.href).href
                ];
                
                function tryPlay(index) {
                    const src = sources[index];
                    currentAudio = new Audio(src);
                    
                    currentAudio.play().then(() => {
                        audioButton.textContent = "â¸ pause";
                        console.log('ðŸª Ð—Ð²ÑƒÐº Ð¡Ð°Ñ‚ÑƒÑ€Ð½Ð° Ð¸Ð³Ñ€Ð°ÐµÑ‚! Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº:', src);
                        // ÐšÐ¾ÑÐ¼Ð¾Ñ ÑƒÐ¶Ðµ Ð²ÐºÐ»ÑŽÑ‡Ñ‘Ð½ Ð¿ÐµÑ€ÐµÐ´ tryPlay, Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð´ÐµÐ»Ð°ÐµÐ¼
                        
                        currentAudio.onended = function() {
                            audioButton.textContent = fact.audioButtonText || "ðŸ”Š listen";
                            unmuteBackgroundSounds();
                            // ÐÐ• Ð²Ñ‹Ñ…Ð¾Ð´Ð¸Ð¼ Ð¸Ð· ÐºÐ¾ÑÐ¼Ð¾ÑÐ° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ â€” Ð¶Ð´Ñ‘Ð¼ ÐºÐ»Ð¸ÐºÐ° Ð¿Ð¾ Ñ„Ð¾Ð½Ñƒ
                            console.log('ðŸª Ð—Ð²ÑƒÐº Ð¡Ð°Ñ‚ÑƒÑ€Ð½Ð° Ð·Ð°ÐºÐ¾Ð½Ñ‡Ð¸Ð»ÑÑ');
                        };
                    }).catch(err => {
                        console.log('âŒ ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð²Ð¾ÑÐ¿Ñ€Ð¾Ð¸Ð·Ð²ÐµÑÑ‚Ð¸ Ð¸Ð·', src, 'ÐžÑˆÐ¸Ð±ÐºÐ°:', err?.name || err);
                        if (index + 1 < sources.length) {
                            tryPlay(index + 1); // ÐŸÑ€Ð¾Ð±ÑƒÐµÐ¼ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº
                        } else {
                            audioButton.textContent = "âŒ file not found";
                            // ÐŸÑ€Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐµ ÐÐ• Ð²Ñ‹Ñ…Ð¾Ð´Ð¸Ð¼ Ð¸Ð· ÐºÐ¾ÑÐ¼Ð¾ÑÐ° â€” Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ÑÐ°Ð¼ ÐºÐ»Ð¸ÐºÐ½ÐµÑ‚ Ð¿Ð¾ Ñ„Ð¾Ð½Ñƒ
                            console.log('ðŸª Ð’ÑÐµ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ¸ Ð½Ðµ ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°Ð»Ð¸, Ð½Ð¾ ÐºÐ¾ÑÐ¼Ð¾Ñ Ð¾ÑÑ‚Ð°Ñ‘Ñ‚ÑÑ');
                        }
                    });
                }
                
                // Ð•ÑÐ»Ð¸ ÑƒÐ¶Ðµ Ð¸Ð³Ñ€Ð°ÐµÑ‚ â€” ÑÑ‚Ð°Ð²Ð¸Ð¼ Ð½Ð° Ð¿Ð°ÑƒÐ·Ñƒ Ð¸ Ð²Ñ‹Ñ…Ð¾Ð´Ð¸Ð¼ Ð¸Ð· ÐºÐ¾ÑÐ¼Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ñ€ÐµÐ¶Ð¸Ð¼Ð°
                if (currentAudio && !currentAudio.paused) {
                    currentAudio.pause();
                    audioButton.textContent = fact.audioButtonText || "ðŸ”Š listen";
                    unmuteBackgroundSounds();
                    // ÐžÑÑ‚Ð°Ñ‘Ð¼ÑÑ Ð² ÐºÐ¾ÑÐ¼Ð¾ÑÐµ, Ð¿Ð¾ÐºÐ° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ ÐºÐ»Ð¸ÐºÐ½ÐµÑ‚ Ð¿Ð¾ Ñ„Ð¾Ð½Ñƒ
                    return;
                }
                
            // Ð¢Ð¸ÑˆÐ¸Ð½Ð° Ñ„Ð¾Ð½Ð° Ð¿ÐµÑ€ÐµÐ´ Ð·Ð°Ð¿ÑƒÑÐºÐ¾Ð¼
            muteBackgroundSounds();
            // Ð¡Ñ€Ð°Ð·Ñƒ Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ ÐºÐ¾ÑÐ¼Ð¾Ñ Ð´Ð»Ñ Ð²Ð¸Ð·ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ ÑÑ„Ñ„ÐµÐºÑ‚Ð° (Ð´Ð°Ð¶Ðµ Ð´Ð¾ ÑÑ‚Ð°Ñ€Ñ‚Ð° Ð°ÑƒÐ´Ð¸Ð¾)
            if (isSaturnCard) enterSaturnMode();
            // Ð¡Ñ‚Ð°Ñ€Ñ‚ÑƒÐµÐ¼ Ñ Ð¿ÐµÑ€Ð²Ð¾Ð³Ð¾ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ°
            tryPlay(0);
            };
        } else {
            audioButton.style.display = 'none';
        }
            
            modal.classList.add('show');
            modalTouchActive = false;
            
            // Ð£Ð²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°ÐµÐ¼ ÑÑ‡Ñ‘Ñ‚Ñ‡Ð¸Ðº ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐµÐº Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð½Ð° ÐºÑ€Ð¾Ð»Ð¸ÐºÐ°
            cardsShownCount++;
            console.log('ðŸ“Š ÐšÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ° Ð¿Ð¾ÐºÐ°Ð·Ð°Ð½Ð°! Ð¡Ñ‡Ñ‘Ñ‚Ñ‡Ð¸Ðº:', cardsShownCount);
            if (cardsShownCount === 3) {
                // Ð¡Ð»ÑƒÑ‡Ð°Ð¹Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð¿Ð¾ÑÐ²Ð»ÐµÐ½Ð¸Ñ ÐºÑ€Ð¾Ð»Ð¸ÐºÐ° (Ð¾Ñ‚ 0.5 Ð´Ð¾ 2 ÑÐµÐºÑƒÐ½Ð´)
                const randomDelay = 500 + Math.random() * 1500; // 500-2000ms
                console.log(`ðŸ° âœ… Ð¡Ñ‡Ñ‘Ñ‚Ñ‡Ð¸Ðº Ð´Ð¾ÑÑ‚Ð¸Ð³ 3! Ð’Ñ‹Ð·Ñ‹Ð²Ð°ÐµÐ¼ ÐºÑ€Ð¾Ð»Ð¸ÐºÐ° Ñ‡ÐµÑ€ÐµÐ· ${Math.round(randomDelay)}ms...`);
                // ÐŸÐ¾ÑÐ»Ðµ 3-Ð¹ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ ÐºÑ€Ð¾Ð»Ð¸ÐºÐ°!
                setTimeout(() => {
                    console.log('ðŸ° â° Ð¢Ð°Ð¹Ð¼ÐµÑ€ ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°Ð»! Ð’Ñ‹Ð·Ñ‹Ð²Ð°ÐµÐ¼ spawnRabbit()...');
                    spawnRabbit();
                }, randomDelay); // ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð¿Ð¾ÑÐ»Ðµ Ð¿Ð¾ÐºÐ°Ð·Ð° ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸
            }
            
            // Ð’Ñ€ÐµÐ¼Ñ Ð¿Ð¾ÐºÐ°Ð·Ð° Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ Ð´Ð»Ð¸Ð½Ñ‹ Ñ‚ÐµÐºÑÑ‚Ð° (fact + caption, Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð½Ð¾ 60Ð¼Ñ Ð½Ð° ÑÐ¸Ð¼Ð²Ð¾Ð», Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ 4 ÑÐµÐº)
            // Ð”Ð»Ñ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐµÐº Ñ Ð°ÑƒÐ´Ð¸Ð¾ - ÐÐ• Ð·Ð°ÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ (Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¿Ð¾ÑÐ»ÑƒÑˆÐ°Ñ‚ÑŒ!)
            clearTimeout(autoCloseTimer);
            
            if (!fact.audioUrl) {
                // Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐµÐº Ð‘Ð•Ð— Ð°ÑƒÐ´Ð¸Ð¾ - Ð°Ð²Ñ‚Ð¾Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ
                const totalText = fact.fact + (fact.caption || '');
                const readingTime = Math.max(4000, totalText.length * 60);
                
                autoCloseTimer = setTimeout(() => {
                    if (!modalTouchActive) {
                        closeModal();
                    }
                }, readingTime);
            }
            // ÐšÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ Ñ Ð°ÑƒÐ´Ð¸Ð¾ Ð¾ÑÑ‚Ð°ÑŽÑ‚ÑÑ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ð¼Ð¸ Ð¿Ð¾ÐºÐ° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ Ð·Ð°ÐºÑ€Ð¾ÐµÑ‚
        }

        // Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ Ð¼Ð¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÐ½Ð° ÐºÐ°Ðº Ð² Instagram Stories
        function closeModal() {
            // ÐžÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð°ÑƒÐ´Ð¸Ð¾ Ð¿Ñ€Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¸
            if (currentAudio && !currentAudio.paused) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            
            // ÐÐ• Ð²Ñ‹Ñ…Ð¾Ð´Ð¸Ð¼ Ð¸Ð· ÐºÐ¾ÑÐ¼Ð¾ÑÐ° Ð¿Ñ€Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¸ Ð¼Ð¾Ð´Ð°Ð»ÐºÐ¸ - Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ ÐºÐ»Ð¸ÐºÑƒ Ð½Ð° Ñ„Ð¾Ð½ Ð¡Ð°Ñ‚ÑƒÑ€Ð½Ð°
            // Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ñ„Ð¾Ð½Ð¾Ð²Ñ‹Ðµ Ð·Ð²ÑƒÐºÐ¸ ÐµÑÐ»Ð¸ Ð½Ðµ Ð² ÐºÐ¾ÑÐ¼Ð¾ÑÐµ
            if (!isSpaceMode) {
                unmuteBackgroundSounds();
            }
            
            const content = document.getElementById('pearlContent');
            content.classList.add('evaporating');
            setTimeout(() => {
                modal.classList.remove('show');
                content.classList.remove('evaporating');
            }, 800);
        }

        // ÐšÐ½Ð¾Ð¿ÐºÐ° Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ
        closeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            closeModal();
        });

        // Ð’ÐÐ–ÐÐž: ÐžÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð²ÑÐ¿Ð»Ñ‹Ñ‚Ð¸Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ Ð¾Ñ‚ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð°ÑƒÐ´Ð¸Ð¾
        // Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ° Ð½Ðµ Ð·Ð°ÐºÑ€Ñ‹Ð²Ð°Ð»Ð°ÑÑŒ Ð¿Ñ€Ð¸ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¸ Ð½Ð° "ÑÐ»ÑƒÑˆÐ°Ñ‚ÑŒ Ð·Ð²ÑƒÐº Ð¡Ð°Ñ‚ÑƒÑ€Ð½Ð°"
        audioButton.addEventListener('touchstart', (e) => {
            e.stopPropagation();
        });
        audioButton.addEventListener('touchend', (e) => {
            e.stopPropagation();
            // Ð­Ð¼ÑƒÐ»Ð¸Ñ€ÑƒÐµÐ¼ click Ð´Ð»Ñ Ð¼Ð¾Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ñ…
            audioButton.click();
        });

        // ÐÐ°Ð¶Ð°Ñ‚Ð¸Ðµ Ð½Ð° ÐšÐžÐÐ¢Ð•ÐÐ¢ - Ð¾ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ñ‚Ð°Ð¹Ð¼ÐµÑ€ Ð¸ Ð´ÐµÑ€Ð¶Ð¸Ð¼ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÑƒ
        document.getElementById('pearlContent').addEventListener('touchstart', (e) => {
            // ÐÐµ Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€ÑƒÐµÐ¼ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ ÐµÑÐ»Ð¸ Ð½Ð°Ð¶Ð°Ð»Ð¸ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð°ÑƒÐ´Ð¸Ð¾
            if (e.target === audioButton || audioButton.contains(e.target)) {
                return;
            }
            e.stopPropagation();
            modalTouchActive = true;
            clearTimeout(autoCloseTimer); // ÐžÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð°Ð²Ñ‚Ð¾Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ
        });

        document.getElementById('pearlContent').addEventListener('mousedown', (e) => {
            e.stopPropagation();
            modalTouchActive = true;
            clearTimeout(autoCloseTimer); // ÐžÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð°Ð²Ñ‚Ð¾Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ
        });

        // ÐžÑ‚Ð¿ÑƒÑÑ‚Ð¸Ð»Ð¸ Ð¿Ð°Ð»ÐµÑ† Ñ ÐšÐžÐÐ¢Ð•ÐÐ¢Ð - Ð·Ð°ÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼
        document.getElementById('pearlContent').addEventListener('touchend', (e) => {
            // ÐÐµ Ð·Ð°ÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼ ÐµÑÐ»Ð¸ Ð½Ð°Ð¶Ð°Ð»Ð¸ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð°ÑƒÐ´Ð¸Ð¾
            if (e.target === audioButton || audioButton.contains(e.target)) {
                e.stopPropagation();
                return;
            }
            e.stopPropagation();
            if (modalTouchActive) {
                closeModal();
                modalTouchActive = false;
            }
        });

        document.getElementById('pearlContent').addEventListener('mouseup', (e) => {
            e.stopPropagation();
            if (modalTouchActive) {
                closeModal();
                modalTouchActive = false;
            }
        });

        // ÐšÐ»Ð¸Ðº Ð½Ð° Ð¤ÐžÐ (Ñ‚ÐµÐ¼Ð½Ð°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ) - ÑÑ€Ð°Ð·Ñƒ Ð·Ð°ÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        // Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÑˆÐ¸Ð²Ð°Ð½Ð¸Ñ Ð¼Ð°ÑÑÐ¸Ð²Ð° (Fisher-Yates shuffle Ñ seed Ð¾Ñ‚ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸)
        function shuffleArray(array) {
            const shuffled = [...array];
            // Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð»Ñ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ð¾ÑÑ‚Ð¸
            const timeSeed = Date.now() % 1000;
            for (let i = shuffled.length - 1; i > 0; i--) {
                // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ timeSeed Ð´Ð»Ñ Ð±Ð¾Ð»ÑŒÑˆÐµÐ¹ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ð¾ÑÑ‚Ð¸
                const j = Math.floor((Math.random() + timeSeed / 10000) * (i + 1)) % (i + 1);
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        // ÐŸÐµÑ€ÐµÐ¼ÐµÑˆÐ¸Ð²Ð°ÐµÐ¼ Ð¼Ð°ÑÑÐ¸Ð²Ñ‹ Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð´Ð»Ñ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ñ€ÑÐ´ÐºÐ°
        console.log('ðŸŽ² ÐŸÐµÑ€ÐµÐ¼ÐµÑˆÐ¸Ð²Ð°Ð½Ð¸Ðµ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐµÐº... Ð’Ñ€ÐµÐ¼Ñ:', Date.now());
        
        // ÐŸÐµÑ€ÐµÐ¼ÐµÑˆÐ¸Ð²Ð°ÐµÐ¼ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ€Ð°Ð· Ð´Ð»Ñ Ð»ÑƒÑ‡ÑˆÐµÐ¹ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ð¾ÑÑ‚Ð¸
        for (let i = 0; i < 5; i++) {
            wisdoms = shuffleArray(wisdoms);
            visualFacts = shuffleArray(visualFacts);
        }
        
        // Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÑˆÐ¸Ð²Ð°Ð½Ð¸Ðµ Ñ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ¾Ð¹ (Ð¿Ð¾ÑÐ»Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ DOM)
        setTimeout(() => {
            wisdoms = shuffleArray(wisdoms);
            visualFacts = shuffleArray(visualFacts);
            console.log('ðŸŽ² Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÑˆÐ¸Ð²Ð°Ð½Ð¸Ðµ! ÐŸÐµÑ€Ð²Ð°Ñ Ð¼ÑƒÐ´Ñ€Ð¾ÑÑ‚ÑŒ:', wisdoms[0]?.substring(0, 30));
        }, 100);
        
        // Ð¡Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼ ÑÐ¿Ð¸ÑÐºÐ¸ Ð¿Ð¾ÐºÐ°Ð·Ð°Ð½Ð½Ñ‹Ñ… ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐµÐº
        shownWisdoms = [];
        shownVisualFacts = [];
        
        // === Ð¢ÐÐ™ÐœÐ•Ð  Ð¤ÐžÐšÐ£Ð¡Ð (Ð¾Ñ‚ÐºÐ»ÑŽÑ‡Ñ‘Ð½) ===
        const focusTimerEl = document.getElementById('focusTimer');
        let focusTimerRunning = false;
        let focusTimerInterval = null;
        
        function updateTimerDisplay() {}
        function startFocusTimer() {}
        function pauseFocusTimer() {}
        
        function stopFocusTimer() {}
        function resetFocusTimer() {}
        
        console.log('ðŸŽ² ÐšÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð¿ÐµÑ€ÐµÐ¼ÐµÑˆÐ°Ð½Ñ‹! ÐŸÐµÑ€Ð²Ð°Ñ Ð¼ÑƒÐ´Ñ€Ð¾ÑÑ‚ÑŒ:', wisdoms[0]);
        console.log('ðŸŽ² ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ñ„Ð°ÐºÑ‚:', visualFacts[0]?.fact);
        
        // === PAUSE SOUNDS WHEN TAB IS HIDDEN ===
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Tab hidden - pause all sounds
                if (ambientAudio) {
                    ambientAudio.pause();
                }
                if (audioContext && audioContext.state === 'running') {
                    audioContext.suspend();
                }
                console.log('ðŸ”‡ Tab hidden - sounds paused');
            } else {
                // Tab visible - resume sounds
                if (ambientAudio && !isSpaceMode) {
                    ambientAudio.play().catch(() => {});
                }
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                console.log('ðŸ”Š Tab visible - sounds resumed');
            }
        });
        
        // === Ð˜ÐÐ˜Ð¦Ð˜ÐÐ›Ð˜Ð—ÐÐ¦Ð˜Ð¯ ===
        // initGrass() Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ð¾ÑÐ»Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ PNG Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ð¹
        animate();
            </script>
</body>
</html>
